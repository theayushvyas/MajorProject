var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Excel=function(t){var i={};function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(n,o,function(i){return t[i]}.bind(null,o));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=21)}({21:function(t,i,e){"use strict";e.r(i);var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};function o(t,i){function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}var r=function(){return(r=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t}).apply(this,arguments)};var s= "16.0.12913.37950";function a(){return s}function c(t){return JSON.stringify(t,Object.getOwnPropertyNames(t))}function u(){var t=new Uint8Array(31),i=function(t){var i={crypto:!1,perfNow:!1,exceptions:[]},e=window.crypto||window.msCrypto;if(e){i.crypto=!0;try{return e.getRandomValues(t),i}catch(t){i.exceptions.push("crypto: "+c(t))}}var n=!1,o=window.performance;try{o&&o.now&&o.now()!==1/0&&(n=!0)}catch(t){i.exceptions.push("perfNow: "+c(t))}for(var r=0;r<t.length;r+=1){try{if(n){i.perfNow=!0;var s=Math.floor(100*o.now())%10;(s<0||s>9)&&(s=0);for(var a=0;a<s;a+=1)Math.random()}}catch(t){i.exceptions.push("Math.random: "+c(t))}t[r]=Math.floor(16*Math.random())}return i}(t),e=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var n=15&t[e];return e+=1,("x"===i?n:3&n|8).toString(16)})),i]}var h,f,l,d=function(){function t(){}return t.prototype.u=function(){},t.prototype.shipAssertTag=function(){},t.prototype.debugAssertTag=function(){},t}();(f=h||(h={}))[f.Error=10]="Error",f[f.Warning=15]="Warning",f[f.Info=50]="Info",f[f.Verbose=100]="Verbose",f[f.Spam=200]="Spam",function(t){t[t.h=0]="msoulscat_ES_EWAJS",t[t.v=1]="msoulscat_ES_EWAJSGrid",t[t.g=6]="msoulscat_ES_EWAJSChart",t[t._=301]="msoulscat_Wac_WordViewer",t[t.O=306]="msoulscat_Wac_BrowserGeneral",t[t.U=320]="msoulscat_Wac_TaskPane",t[t.A=339]="msoulscat_Wac_OneNoteGeneral",t[t.R=340]="msoulscat_Wac_Ribbon",t[t.P=379]="msoulscat_Wac_WopiPendingApplication",t[t.W=383]="msoulscat_Wac_Telemetry",t[t.F=391]="msoulscat_Wac_WacCatchUpActivities",t[t.N=394]="msoulscat_Wac_Dictation",t[t.k=395]="msoulscat_Wac_OneNoteSync",t[t.B=700]="msoulscat_Wac_VisioApp",t[t.H=1601]="msoulscat_OneNoteOnline_EditableCache",t[t.J=800]="msoulscat_Wac_PptAnimation",t[t.j=833]="msoulscat_Wac_PptLive",t[t.q=834]="msoulscat_Wac_PptMWeb",t[t.X=815]="msoulscat_Wac_PptShape",t[t.Z=817]="msoulscat_Wac_PptSession",t[t.$=830]="msoulscat_Wac_PptSlideshow",t[t.K=2300]="msoulscat_Wac_VersionHistory",t[t.Y=302]="msoulscat_Wac_WordPresence",t[t.tt=3005]="msoulscat_Wac_WordVersionHistory",t[t.it=3006]="msoulscat_Wac_LivePersonaCard",t[t.et=3012]="msoulscat_Wac_CatchUpFlyout"}(l||(l={}));var p;(function(){function t(){}t.tagIntToString=function(i){return i<=t.maxNumericTag?i.toString():i>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,255&i):t.map.charAt(i>>24&63)+t.map.charAt(i>>18&63)+t.map.charAt(i>>12&63)+t.map.charAt(i>>6&63)+t.map.charAt(63&i)},t.getLogMessage=function(i,e,n){return"tag_"+t.tagIntToString(i)+" ["+l[e]+"] "+n},t.prototype.u=function(i,e,n,o){var r=console.log;switch(n){case h.Error:r=console.error;break;case h.Warning:r=console.warn;break;case h.Info:r=console.info;break;case h.Verbose:r=console.debug;break;case h.Spam:default:r=console.log}try{r(t.getLogMessage(i,e,o))}catch(t){var s="undefined"!=typeof navigator?navigator:void 0;if(s&&!/rv:11.0/i.test(s.userAgent))throw t}},t.prototype.shipAssertTag=function(i,e,n,o){console.assert(n,t.getLogMessage(i,e,o))},t.prototype.debugAssertTag=function(t,i,e,n){this.shipAssertTag(t,i,e,n)},t.maxNumericTag=65535,t.minOldSchemeHighByteValue=36,t.map="abcdefghijklmnopqrstuvwxyz0123456789"})(),new(function(){function t(){this.externalLogger=new d}return t.prototype.setLogger=function(t){this.externalLogger=t},t.prototype.u=function(t,i,e,n){this.externalLogger.u(t,i,e,n)},t.prototype.debugAssertTag=function(t,i,e,n){this.externalLogger.debugAssertTag(t,i,e,n)},t.prototype.shipAssertTag=function(t,i,e,n){this.externalLogger.shipAssertTag(t,i,e,n)},t}());function v(t,i,e){if(""!==i){var n=new XMLHttpRequest;n.readyState!==XMLHttpRequest.UNSENT&&n.readyState!==XMLHttpRequest.DONE||(n.open("POST",i,e),n.send(t))}}function w(t,i,e,n){var o=t.map((function(t){return function(t,i){var e={};e.G=t.tag,e.T=t.timestamp-i,e.M=t.message,e.C=t.category;var n=1e3*t.type+t.level;return e.D=n,e}(t,n)})),r=function(t,i,e,n){var o={};return o.T=t,o.L=i,o.S=e,o.I=n,o.V=1,o}(n,o,i,e);return JSON.stringify(r)}!function(t){t[t.Trace=0]="Trace",t[t.Assert=1]="Assert"}(p||(p={}));!function(){function t(i,e){var n=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){n.triggerUpload(!1,!1)},this.flush=function(){n.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return n.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(i,e){(window.clearTimeout(n.timeoutId),n.logCache.length>0)&&(n.uploadId+=1,v(w(n.logCache,n.userSessionId,n.uploadId,n.timestampBase),n.remoteUrlEndpoint,e),n.logCache=[],n.timestampBase=Date.now());i&&(n.timeoutId=window.setTimeout(n.triggerUploadAsync,t.uploadCadenceInMsSec))},this.userSessionId=i,this.remoteUrlEndpoint=e+"?usid="+i,window.setTimeout((function(){return n.triggerUpload(!0,!0)}),0)}t.prototype.handleTrace=function(i){i.message.length>t.messageMaxChars&&(i.message=i.message.substr(0,t.messageMaxChars-t.trimmedMessage.length)+t.trimmedMessage),this.logCache.push(i),(this.logCache.length>t.uploadTriggerSize||i.level===h.Error)&&this.triggerUploadAsync()},t.messageMaxChars=3072,t.uploadCadenceInMsSec=3e4,t.uploadTriggerSize=30,t.trimmedMessage="... [Trimmed]"}();h.Info;!function(t){function i(){return null!==t&&t.apply(this,arguments)||this}o(i,t)}(d);var m,g,S=function(){function t(t,i){var e=this;this.nt=3072,this.ot="... [Trimmed]",this.rt=1e3,this.st=3e4,this.at=30,this.ct=0,this.ut=[],this.ht=Date.now(),this.ft="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){e.lt(!1,!1)},this.flush=function(){e.dt()},this.dt=function(){window.setTimeout((function(){return e.lt(!0,!0)}),0)},this.lt=function(t,i){if(window.clearTimeout(e.pt),e.vt){if(e.ut.length>0)e.ct+=1,v(w(e.ut.splice(0,t?e.at:e.ut.length),e.ft,e.ct,e.ht),e.vt,i),e.ht=Date.now();t&&(e.pt=window.setTimeout(e.dt,e.ut.length>e.at?e.rt:e.st))}},this.ft=t,i&&this.configure(i)}return t.prototype.configure=function(t){var i=this;if(t.uploadCadenceInMs&&(this.st=t.uploadCadenceInMs),t.uploadTriggerSize&&(this.at=t.uploadTriggerSize),t.remoteUlsEndpoint){if(this.vt)throw new Error("Remote ULS endpoint is already set");this.vt=t.remoteUlsEndpoint+"?usid="+this.ft,this.ht=Date.now(),window.setTimeout((function(){return i.lt(!0,!0)}),0)}},t.prototype.handleTrace=function(t){t.message.length>this.nt&&(t.message=t.message.substr(0,this.nt-this.ot.length)+this.ot),this.ut.push(t),(this.ut.length>this.at||t.level===h.Error)&&this.dt()},t}(),_=[];!function(t){t.wt="ExcelInstantShellEnabled",t.gt="BootstrapperMaxUlsHeartbeatTime",t.St="BootstrapperNoCompleteWarning1Time",t._t="BootstrapperNoCompleteWarning2Time",t.bt="RemoteUlsETag",t.yt="RemoteUlsSuppressions",t.It="BootstrapperSettingsFetchPeriod",t.Ot="timestamp",t.Et="BootstrapperUlsHeartbeatIntervalMs",t.Tt="BootstrapperUlsHeartBeatIsEnabled",t.xt="BootstrapperUlsUploadCadenceMs"}(g||(g={}));function b(t,i){var e=new S(t,i);function n(t,i,n,o){if(!function(t){return 1===_[t]}(t)){var r={timestamp:Date.now(),category:i,tag:t,level:n,type:p.Trace,message:o};e.handleTrace(r)}}return{ULS:{u:function(t,i,e,o){n(t,i,e,o)},shipAssertTag:function(t,i,e,o){e&&n(t,i,h.Error,o)},debugAssertTag:function(t,i,e,n){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:e.flush,flushOnClose:e.flushOnClose},configure:function(t){e.configure(t)},settingsChangeHandler:function(t){var i,n;i=t.getSettingValue(g.yt,""),n=t.getSettingValue(g.bt,""),m&&n===m||(_=[],m=n,i&&i.split(",").forEach((function(t){var i=parseInt(t,10);i&&(_[i]=1)}))),e.configure({uploadCadenceInMs:t.getSettingValue(g.xt,6e4)})}}}var y,I,O,E,T,x;function C(t){return 8===t.toLowerCase().indexOf("ffc")}function U(t){return 8===t.toLowerCase().indexOf("ppc")}function A(t){var i=t.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}function R(t,i){var e=t.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!e)throw new Error("Invalid URL");var n=e[2];if(void 0===i)return n;if(i<0)throw new Error("subDomainParts should be at least 1");return n.split(".").slice(-(i+1)).join(".")}function P(){if(null!=navigator&&null!=navigator.userAgent){var t=navigator.userAgent;if(t.indexOf("Firefox")>-1)return y.Firefox;if(t.indexOf("Opera")>-1)return y.Opera;if(t.indexOf("Trident")>-1)return y.IE;if(t.indexOf("Edge")>-1)return y.Edge;if(t.indexOf("Chrome")>-1)return y.Chrome;if(t.indexOf("Safari")>-1)return y.Safari}return y.Unknown}function W(){try{return navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("Macintosh")>=0&&N()&&!(navigator.userAgent.indexOf("iPhone")>=0)||navigator.userAgent.indexOf("Android")>=0||N()}catch(t){return!1}}function F(){return P()===y.IE&&!function(){if(P()!==y.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function N(){return navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function k(t,i){var e=t.indexOf("&"+i+"=");if(-1===e&&(e=t.indexOf("?"+i+"=")),-1===e)return"";var n=e+(i.length+2),o=t.indexOf("&",n);return-1===o?t.substr(n):t.substring(n,o)}function D(t,i,e,n){if(void 0===n&&(n=!1),!e)return t;var o=t,r=o.indexOf("?"),s="&";r===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?s="":-1===r&&(s="?");var a=i.toLowerCase()+"=",c=o.toLowerCase().indexOf(a,r);if("?"!==s&&c>=0){if(n){var u=o.indexOf("&",c);o=o.substring(0,c)+a+e+(-1===u?"":o.substring(u))}return o}return o.concat(s,a,e)}function M(t){if(null==t)return"";var i=-1===t.indexOf("#")?t.length:t.indexOf("#"),e=t.lastIndexOf("/",i);if(-1!==e&&e+1===t.indexOf("://")+"://".length)return"";e+=1;var n=t.indexOf("?");if(-1!==(n=n>=i?-1:n)&&e>n)return"";var o=-1===n?i:n;return e>=o?"":t.substring(e,o)}function L(t){var i=t.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}function B(t,i){i&&i.Diagnostics&&Object.keys(i.Diagnostics).forEach((function(e){return t[e]=i.Diagnostics[e]}))}function H(){if(window&&window.navigator){var t=window.navigator,i=t.connection||t.mozConnection||t.webkitConnection,e={};return i&&(e.netEffectiveType=i.effectiveType,e.netDownlink=i.downlink,e.netType=i.type,e.netDownlinkMax=i.downlinkMax,e.netRtt=i.rtt,e.netSaveData=i.saveData),e.deviceMemory=t.deviceMemory,e.logicalProcessors=t.hardwareConcurrency,e}}function J(t,i,e){i.ULS.u(596459999,l.P,e,"SessionTraces: "+JSON.stringify(t))}function j(t,i,e){e.Stop();var n=e.GetVisibilityChangeEvents();null!=n&&n.length>0&&(t.documentLoadedWithTabSwitch=!0,i.tabSwitchDiagnostics=JSON.stringify(n)),e.Dispose()}function z(t){try{if(void 0===window.performance)return void t.ULS.u(595948609,l.P,h.Info,"Performance not supported");var i=window.performance.getEntriesByType("resource");if(void 0===i||i.length<=0)return void t.ULS.u(595948610,l.P,h.Info,"No resources under performance");for(var e=new RegExp("excel-boot.min.js|word.boot.js|visio.boot.js|onenote-boot.js","i"),n=0,o=i;n<o.length;n++){var r=o[n];if(e.test(r.name)){var s=JSON.stringify(r),a=M(r.name);return s=s.replace(new RegExp(r.name,"g"),a),void t.ULS.u(595948616,l.P,h.Info,s)}}t.ULS.u(595948484,l.P,h.Info,"Could not find JSAPI resource timing entry")}catch(i){t.ULS.u(595948617,l.P,h.Info,"Could not trace the resource timing: "+c(i))}}function V(t,i,e){if(t){var n="Page lifecycle: "+i+" fired.";n+=e?" Flushing ULS logger":"",t.ULS.u(595957843,l.P,h.Info,n),e&&t.ULS.flush()}}function q(t,i,e){t.ULS.u(596464283,l.P,h.Info,"Initializing session. Build version: "+a()),e&&t.ULS.u(595937313,l.P,h.Info,JSON.stringify(e)),i.rebootOverrideData&&(i.rebootOverrideData.previousSessionId||t.ULS.u(594613645,l.P,h.Warning,"Missing previous session id")),t.ULS.u(595632928,l.P,h.Info,function(){if(window&&window.navigator){var t=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;if(t)return"EffectiveType: "+t.effectiveType+", BandwidthMps: "+t.downlink+", ConnectionType: "+t.type}return""}()),i&&i.wopiInfo&&i.wopiInfo.AccessToken&&i.wopiInfo.AccessTokenExpiry?(0===i.wopiInfo.AccessToken.length||i.wopiInfo.AccessTokenExpiry.getTime()<=Date.now())&&t.ULS.u(595894621,l.P,h.Error,"Invalid AccessToken. AccessTokenLength: "+i.wopiInfo.AccessToken.length+", AccessTokenExpiry: "+i.wopiInfo.AccessTokenExpiry+", AccessTokenTTL: "+i.wopiInfo.AccessTokenExpiry.getTime()+", DateNow: "+Date.now()):t.ULS.u(595894553,l.P,h.Warning,"There are some missing paramters");var n=function(t,i){var e=JSON.parse(JSON.stringify(i));delete e.UserId,delete e.OwnerId,delete e.WdParams;var n=i.WdParams?JSON.parse(JSON.stringify(i.WdParams).toLowerCase()):{};return e.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf","wdsandboxwacframe"].forEach((function(t){n[t]&&(e.WdParams[t]=n[t])})),e.UiEmbedMode=t.toLowerCase().indexOf("uiembed=1")>=0,e.UiHostName=k(t,"uih")||"N/A",e.hostName=location?location.hostname:"",e}(i.applicationUrl,i.sessionInformation);t.ULS.u(596444237,l.P,h.Info,JSON.stringify({hostSessionInformation:n,clientSignals:H()})),t.ULS.u(596444238,l.P,h.Info,"HostInitDiagnostics: "+(i.diagnostics.HostInitializeDiagnostics?JSON.stringify(i.diagnostics.HostInitializeDiagnostics):"N/A"))}function G(t,i,e){void 0===e&&(e=!1);var n=t.applicationUrl;t.wopiPrecheckInfo.IsNewFile&&n.replace("unified=1","edit=1&new=1");var o={jsApi:"1"};if(e&&(o.NewSession="1"),o.corrid=t.sessionId,o.usid=t.sessionId,(t.applicationCustomSettings&&t.applicationCustomSettings.IsCore||t.sessionInformation.IsCore)&&(o.core="1"),t.sessionInformation.HideViewerToolbar&&(o.hvt="1"),t.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),t.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(t.sessionInformation.HighContrastMode)),t.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),t.sessionInformation.SupportsDocReboot){var s=t.sessionInformation.SupportsDocReboot;o.sdr=!0===s?"1":s.toString()}return t.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),t.sessionInformation.HideHeader&&(o.hhdr="1"),t.applicationCustomSettings&&t.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),t.wopiPrecheckInfo.ReadOnly&&(o.readOnly="1"),t.sessionInformation.UIEmbed&&(o.uiEmbed="1"),t.applicationCustomSettings&&t.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),i.isSingleStepBoot?(i.bootFlowType===x.unifiedSingleFlush&&(t.isCreateNew||(o.instantedit="1",o.wopicomplete="1")),o.wdRedirectionReason=i.bootFlowType):(o.instantedit="1",o.fileSrc=encodeURIComponent(t.sessionInformation.HostName),o.pmOrigin=encodeURIComponent(A(window.location.href)),t.isCreateNew&&(o.new="1",t.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(o.wdTpl="fromhost"))),t.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(t.wopiPrecheckInfo.PreseededSessionKey)),t.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(t.wopiPrecheckInfo.PreseededWacSessionId)),t.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=t.wopiPrecheckInfo.RequestedCallThrottling),t.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=t.wopiPrecheckInfo.ClientThrottlingProtection),function(t){var i=t.featureManager.isFeatureEnabled(E.Ct),e=t.applicationUrl;return(C(e)||U(e))&&t.settingsManager.getSettingValue(g.wt,!1)||i;return!1}(t)&&(o.instantshell="1"),t.applicationCustomSettings&&t.applicationCustomSettings.additionalApplicationParameters&&(o=r(r({},t.applicationCustomSettings.additionalApplicationParameters),o)),t.rebootOverrideData&&t.rebootOverrideData.queryOverrides&&(o=r(r({},o),t.rebootOverrideData.queryOverrides)),function(t,i,e,n,o){var s=function(t){var i={},e=t.indexOf("?");return-1===e||e===t.length-1||t.substring(e+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(t){if(t){var e=t.indexOf("=");-1!==e&&e!==t.length-1&&(i[t.substring(0,e).toLowerCase()]=t.substring(e+1))}})),i}(t);"teams"!==s.uih&&"owa"!==s.uih||(s.hhdr="1");var a=t.indexOf("?"),c=-1===a?t.concat("?"):t.substring(0,a+1);i.UiLocale&&(s.ui=encodeURIComponent(i.UiLocale));i.DataLocale&&(s.rs=encodeURIComponent(i.DataLocale));i.HostSessionId&&(s.hid=encodeURIComponent(i.HostSessionId));i.DisableChat&&(s.dchat="1");i.SessionContext&&(s.sc=encodeURIComponent(i.SessionContext));e&&e.WopiSrc&&(s.wopisrc=encodeURIComponent(e.WopiSrc));i.CookieCompliant&&(s.mscc="1");n&&(n.entryPoint&&(s.wdorigin=encodeURI(n.entryPoint)),n.userClickTime&&(s.wdhostclicktime=n.userClickTime.toString()));s=r(r(r({},s),i.WdParams),o);var u={};for(var h in s)u[h.toLowerCase()]=s[h];var f=[];for(var h in u)u[h]&&f.push(h.concat("=",u[h]));return c.concat(f.join("&"))}(n,t.sessionInformation,t.wopiInfo,t.diagnostics.HostInitializeDiagnostics,o)}function X(t){return t.AccessTokenExpiry?t.AccessTokenExpiry.getTime().toString():"0"}!function(t){t[t.Firefox=0]="Firefox",t[t.Opera=1]="Opera",t[t.IE=2]="IE",t[t.Edge=3]="Edge",t[t.Chrome=4]="Chrome",t[t.Safari=5]="Safari",t[t.Unknown=6]="Unknown"}(y||(y={})),function(t){t.Ut="App_AccessibilityLoopComplete",t.At="Wac_AppFailed",t.Rt="Wac_AppBootState",t.Pt="Wac_AppCompleted",t.Wt="BrowserEvent",t.Ft="UI_Close",t.Nt="UI_Conversation",t.kt="UI_CopyAndEdit",t.Dt="UI_Download",t.Mt="Error",t.Lt="UI_FileEmbed",t.Bt="UI_FileProperties",t.Ht="File_Rename",t.Jt="File_RenameFailed",t.jt="UI_FileVersions",t.zt="StateChanged",t.Vt="App_WopiInfoFromUrl",t.qt="WacInitialize_FrameLoaded",t.Gt="WacInitialize_Ready",t.Xt="App_LoadingStatus",t.Zt="App_SwitchMode",t.$t="UI_OpenInBrowser",t.Kt="UI_OpenInClient",t.Qt="PageChanged",t.Yt="App_PushState",t.ti="App_DocReboot",t.ii="UI_RedeemForCommenting",t.ei="App_RefreshSessionInfo",t.ni="UI_ReplyWithChanges",t.oi="UI_ReportAbuse",t.ri="UI_SaveStatus",t.si="WopiSession_Complete_Ack",t.ai="UI_Sharing",t.ci="UI_ShareForm",t.hi="UI_SignIn",t.fi="App_IsFrameTrusted",t.li="App_Unloaded",t.di="PageCount",t.pi="UI_CheckUserAccessAndGrantPermissions",t.vi="User_Activity",t.wi="Edit_Notification",t.mi="UI_Workflow",t.gi="ZoomChanged"}(I||(I={})),function(t){t.Si="Ack",t._i="Blur_Focus",t.bi="Wac_AppFailed_Ack",t.yi="Wac_AppCompleted_Ack",t.Ii="Host_AccessibilityLoopComplete",t.Oi="WopiPendingSession_Fail",t.Ei="Grab_Focus",t.Ti="HostCacheDiagnostic",t.xi="WacInitialize_Ready_Ack",t.Ci="JsApiDiagnostics",t.Ui="PageChanged_Ack",t.Ai="WopiPendingApplicationComplete_Received",t.Ri="WopiPendingSession_Complete",t.Pi="App_PopState",t.Wi="Host_PostmessageReady",t.Fi="File_Rename",t.Ni="CanEmbed",t.ki="Host_RefreshSessionInfo",t.Di="CheckUserAccessAndGrantPermissions_Result",t.Mi="Host_WopiInfoFromUrl",t.Li="SetCurrentPage",t.Bi="SetZoomLevel",t.Hi="WopiStartSession_Complete",t.Ji="Host_SwitchMode",t.fi="Host_IsFrameTrusted",t.ji="Host_Unload",t.zi="PageCount_Ack",t.Vi="ZoomChanged_Ack"}(O||(O={})),function(t){t.qi="EnterpriseTemplates",t.Gi="ExcelAdaptiveLayoutDownload",t.Xi="ExcelHashedUrl",t.Zi="ExcelLandingPageOfflineTelemetry",t.$i="ExcelLandingPageObserverRetry",t.Ki="H2StaticContent",t.Qi="HashedUrl",t.Ct="InstantShell",t.Yi="ODCShareLinkPreload",t.te="OfficeComUiHost"}(E||(E={})),function(t){t.Unknown="Unknown",t.AppInitError="AppInitError",t.ApiDisabledError="ApiDisabledError",t.CannotLoadFirstPage="CannotLoadFirstPage",t.CannotLoadScript="CannotLoadScript",t.PageChangeError="PageChangeError",t.ZoomChangeError="ZoomChangeError",t.CannotLoadBundleItem="CannotLoadBundleItem",t.InvalidPageIndex="InvalidPageIndex",t.UnsupportedBundleVersion="UnsupportedBundleVersion",t.InvalidWopiInfo="InvalidWopiInfo",t.TimeoutWacReady="TimeoutWacReady",t.WacFailed="WacFailed"}(T||(T={})),function(t){t.bootWithoutWopiInfo="",t.unifiedSingleFlush="Unified_SingleFlush",t.unifiedIrmEnabled="Unified_IrmEnabled",t.unifiedViewActionUrl="Unified_ViewActionUrl",t.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",t.forceSingleStepBoot="Force_SingleStepBoot",t.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",t.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect"}(x||(x={}));var Z,$,K,Q,Y,tt,it,et=!1,nt=!1,ot=["xlviewerinternal.aspx","xlembed.aspx"],rt=0;function st(t,i,e,n){K=t,Q=i,tt=e,it=n,at(),setTimeout((function(){K.ULS.u(593589517,l.P,h.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver heartbeat signal called after ms: 3000")}),3e3),setTimeout((function(){!function t(){if(rt>=3)return void K.ULS.u(595350870,l.P,h.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Max Limit reached for retry attempts3");if(at(),et)setTimeout((function(){(!nt||rt>0)&&K.ULS.u(595350872,l.P,h.Info,"ExcelLandingPageObserver: checkSecondFlushArrived Second Flush status: "+nt+" after first flush retry attempt: "+rt)}),$);else{if(rt+=1,K.ULS.u(595350871,l.P,h.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Retry Request: "+rt),tt.isFeatureEnabled(E.$i)&&1===rt)document.getElementById(Q).submit();setTimeout((function(){t()}),Z)}}()}),Z),tt.isFeatureEnabled(E.Zi)&&(window.localStorage?window.addEventListener("offline",ct):K.ULS.u(593589518,l.P,h.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver localstorage not supported by Browser. Skip saving in cache")),K.ULS.u(594622165,l.P,h.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver called with OfflineTelemetry: "+tt.isFeatureEnabled(E.Zi))}function at(){Z=3750,$=6e3;var t=function(){if(window&&window.navigator){var t=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return t?t.effectiveType:void 0}}();if(void 0!==t)switch(void 0!==Y&&Y!==t&&K.ULS.u(595350873,l.P,h.Info,"ExcelLandingPageObserver: initializeTimeOutIntervals previousConnection: "+Y+" currentConnection: "+t+" First Flush: "+et+" Second Flush:"+nt),Y=t,t){case"4g":Z=3750,$=6e3;break;case"3g":Z=5e3,$=8e3;break;case"2g":Z=1e4,$=24e3;break;case"slow-2g":Z=2e4,$=4e4}}function ct(){try{var t=(new Date).getTime(),i="OfflineMode_"+it+"_"+t,e={"Sessionid:":it,OfflineTime:t};localStorage.setItem(i,JSON.stringify(e))}catch(t){K.ULS.u(593589522,l.P,h.Error,"ExcelLandingPageObserver:logOfflineModeTelemetry exception during saving into cache exception: "+c(t))}}var ut;function ht(t,i,e,n,o,r,s,a){var c=function(t,i,e,n,o){var r=t.ownerDocument.createElement("iframe");r.name=n||"WebApplicationFrame",r.id="WebApplicationFrame",r.src="",r.title="Office Online Frame",r.width="100%",r.height="100%",r.marginWidth="0",r.marginHeight="0",r.style.left="0",r.style.top="0",r.style.right="0",r.style.bottom="0",r.style.display="block",r.style.position="absolute",r.style.backgroundColor="transparent",r.style.border="none",r.frameBorder="0",r.setAttribute("allowfullscreen","true"),r.setAttribute("allowTransparency","true"),e&&r.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation allow-popups-to-escape-sandbox");var s=A(i);return r.setAttribute("allow","microphone "+s+"; camera "+s+";"),o&&(r.onload=o),t.appendChild(r),r}(t,i,n,r);return function(t){return ot.some((function(i){return-1!==t.indexOf(i)}))}(i)&&st(s,"office_form",o,a),function(t,i,e,n){!function(t,i){i[ut.wacFrameComputedHeightPx]=String(t.offsetHeight),i[ut.wacFrameComputedWidthPx]=String(t.offsetWidth),i[ut.wacFrameTouchMode]=String(W()),i[ut.wacFrameHighContrast]=String(function(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(t){return!1}}()),i[ut.wacFrameForceSLR]=String(function(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(t){return!1}}())}(t,n);var o=i.ownerDocument,r=o.createElement("form");for(var s in r.id="office_form",r.name="office_form",r.action=e,r.target=t.name,r.method="POST",n){var a=o.createElement("input");a.type="hidden",a.name=s,a.value=n[s],r.appendChild(a)}return i.appendChild(r),r.submit(),t}(c,t,i,e)}function ft(t,i){var e={};if(t.wopiInfo&&(e[ut.wacFrameAccessToken]=t.wopiInfo.AccessToken,e[ut.wacFrameAccessTokenTtl]=X(t.wopiInfo)),t.wopiPrecheckInfo.BundleInfo&&t.wopiPrecheckInfo.BundleInfo.Url&&t.wopiPrecheckInfo.BundleInfo.Url.length>0)if(e[ut.wacFrameBundleSource]=t.wopiPrecheckInfo.BundleInfo.Url,null!=t.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==t.wopiPrecheckInfo.BundleInfo.BundleStaleness){var n=t.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();i.ULS.u(593503580,l.P,h.Info,"Content bundle staleness - "+n),e[ut.wacFrameBundleStaleness]=n}else i.ULS.u(593503581,l.P,h.Info,"Content bundle staleness does not exist");if(t.wopiPrecheckInfo.FileGetUrl&&(e[ut.wacFrameFileGetUrl]=t.wopiPrecheckInfo.FileGetUrl),t.wopiPrecheckInfo.FileName){var o=t.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==o){var r=t.wopiPrecheckInfo.FileName.substring(o+1);r&&(e[ut.wacFrameFileExtension]=r)}e[ut.wacFrameFileName]=t.wopiPrecheckInfo.FileName}return t.newFileTemplateSource&&t.newFileTemplateSource.FileSize?e[ut.wacFrameFileSize]=t.newFileTemplateSource.FileSize.toString():t.wopiPrecheckInfo.FileSize&&(e[ut.wacFrameFileSize]=t.wopiPrecheckInfo.FileSize.toString()),t.sessionInformation.UserId&&(e[ut.wacFrameUserId]=t.sessionInformation.UserId),t.sessionInformation.OwnerId&&(e[ut.wacFrameOwnerId]=t.sessionInformation.OwnerId),t.sessionInformation.SessionContext&&(e[ut.wacFrameSessionContext]=t.sessionInformation.SessionContext),t.diagnostics&&(e[ut.wacFrameHostDiagnostics]=JSON.stringify(t.diagnostics)),e[ut.wacFrameFeatureStatus]=function(t,i){var e={};if(Object.keys(E).forEach((function(i){var n=t.isFeatureEnabled(E[i]);void 0!==n&&(e[E[i]]=n?"1":"0")})),i&&i.wdFlights)for(var n=i.wdFlights.toLowerCase(),o=0,r=n.split(",");o<r.length;o++){var s=r[o];"et-treatment"!==s&&"et-control"!==s||(e[E.qi]="et-treatment"===s?"1":"0")}return JSON.stringify(e)}(t.featureManager,t.sessionInformation.WdParams),t.applicationCustomSettings&&t.applicationCustomSettings.HostUIControls&&(e[ut.wacFrameHostUIControlOverrides]=JSON.stringify(t.applicationCustomSettings.HostUIControls)),e[ut.wacFrameHighDpi]=String(window.devicePixelRatio>1.24),e[ut.wacSoftBlockedBrowser]=String(F()),e[ut.wacFrameHostName]=t.sessionInformation.HostName,t.newFileTemplateSource&&(e[ut.wacFrameTemplateUrl]=t.newFileTemplateSource.FileGetUrl),t.newFileTemplateSource&&t.newFileTemplateSource.DocUniqueId?e[ut.wacFrameDocID]=t.newFileTemplateSource.DocUniqueId:t.wopiPrecheckInfo.DocUniqueId&&(e[ut.wacFrameDocID]=t.wopiPrecheckInfo.DocUniqueId),t.newFileTemplateSource&&t.newFileTemplateSource.ETag?e[ut.wacFrameETag]=t.newFileTemplateSource.ETag:t.wopiPrecheckInfo.ETag&&(e[ut.wacFrameETag]=t.wopiPrecheckInfo.ETag),e}!function(t){t.wacFrameAccessToken="access_token",t.wacFrameAccessTokenTtl="access_token_ttl",t.wacFrameBundleSource="bundleSrc",t.wacFrameBundleStaleness="bundleStaleness",t.wacFrameFileGetUrl="fileGetUrl",t.wacFrameFileExtension="fileExtension",t.wacFrameFileSize="fileSize",t.wacFrameFileName="fileName",t.wacFrameOwnerId="owner_id",t.wacFrameUserId="user_id",t.wacFrameSessionContext="sc",t.wacFrameHostDiagnostics="host_diagnostics",t.wacFrameHighDpi="highDpi",t.wacFrameComputedHeightPx="frameHeightPx",t.wacFrameComputedWidthPx="frameWidthtPx",t.wacFrameHostFlights="hostFlights",t.wacFrameHighContrast="highContrast",t.wacFrameTouchMode="touchMode",t.wacFrameHostUIControlOverrides="huictrls",t.wacSoftBlockedBrowser="softBlockedBrowser",t.wacFrameHostName="hostName",t.wacFrameFeatureStatus="feature_status",t.wacFrameTemplateUrl="templateUrl",t.wacFrameETag="ETag",t.wacFrameDocID="DocID",t.wacFrameForceSLR="forceSLR"}(ut||(ut={}));var lt=function(){function t(t,i,e,n,o,r,s,a){if(this.ie=!1,this.ee=void 0,this.ne=[],void 0===i)throw new TypeError("bootFlowInfo");if(i.isSingleStepBoot&&void 0===t.wopiInfo)throw new TypeError("wopiInfo");this.oe=t,this.re=i,this.se=o,this.ae=r,this.ce=s,this.ue=a,this.he=e,this.fe=n,this.fe.wopiInitializeTime=Date.now()}return t.prototype.Boot=function(){var t=this;this.se.ULS.u(596444241,l.P,h.Info,"Initializing WAC frame");var i=G(this.oe,this.re,!0),e=ft(this.oe,this.se);if(this.oe.settingsManager.getSettingValue(g.Tt,!1)&&this.beginUlsHeartBeat(this.oe.settingsManager.getSettingValue(g.Et,C(i)?3e3:5e3)),this.ae.registerMessagePayloadHandler(I.Rt,(function(i){t.handleWacAppBootState(i)})),this.ae.registerMessagePayloadHandler(I.fi,(function(i){t.handleTrustFrameRequest(i)})),this.re.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(i,e),this.re.ignoreWacFramePostMessages){var n=this.getApplicationState();this.ce(n)}return this.se.ULS.u(595661019,l.P,h.Info,"Created Wac Frame"),this.le},t.prototype.bootWacFrame=function(t,i){this.he.officeFrameCreateTime=Date.now(),this.fe.frameCreateStartTime=this.he.officeFrameCreateTime;var e=!(!this.oe.sessionInformation.WdParams||!this.oe.sessionInformation.WdParams.wdSandboxWacFrame),n=this.oe.applicationCustomSettings&&this.oe.applicationCustomSettings.appFrameName;this.le=ht(this.oe.container,t,i,e,this.oe.featureManager,n,this.se,this.he.officeSessionId),this.ae.activate(this.le)},t.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var t=this;this.ae.registerMessagePayloadHandler(I.Pt,(function(i){t.handleWacCompleteMessage(i)})),this.ae.registerMessagePayloadHandler(I.At,(function(i){t.handleWacFailureMessage(i)})),this.ne.push(window.setTimeout((function(){return t.timeoutWacAppCompleteOrFail()}),15e3)),this.ne.push(window.setTimeout((function(){return t.logWarningOnNoAppComplete(1)}),this.oe.settingsManager.getSettingValue(g.St,6e4))),this.ne.push(window.setTimeout((function(){return t.logWarningOnNoAppComplete(2)}),this.oe.settingsManager.getSettingValue(g._t,18e4)))},t.prototype.handleWacAppBootState=function(t){var i=t&&t.state?t.state:"unknown";this.se.ULS.u(595714271,l.P,h.Info,"WAC Boot App state:["+i+"]"),function(t){"PageLoadSkeleton Presented"===t?et=!0:"BootstapContext Recieved"===t&&(nt=!0)}(i)},t.prototype.handleTrustFrameRequest=function(t){var i=window===window.top||window.parent===window.top&&window.location.origin===window.top.origin;this.se.ULS.u(595653903,l.P,h.Info,"Top frame is trusted: "+i),this.ae.sendPostMessage(this.le.contentWindow,O.fi,{isTopFrameTrusted:i})},t.prototype.handleWacCompleteMessage=function(t){if(this.se.ULS.u(595986314,l.P,h.Info,"Received wac complete message"),this.se.ULS.flush(),this.endUlsHeartBeat(),this.clearLogTimers(),function(){if(tt.isFeatureEnabled(E.Zi))if(window.localStorage)for(var t=0;t<localStorage.length;t+=1)try{var i=localStorage.key(t);if("OfflineMode_"===i.substring(0,"OfflineMode_".length)){var e=localStorage.getItem(i);K.ULS.u(593589520,l.P,h.Info,"ExcelLandingPageObserver:uploadOfflineModeTelemetry Message"+e),localStorage.removeItem(i)}}catch(t){K.ULS.u(593589521,l.P,h.Error,"ExcelLandingPageObserver:uploadOfflineModeTelemetry exception during loading from cache. Exception: "+c(t))}else K.ULS.u(593589519,l.P,h.Info,"ExcelLandingPageObserver:uploadOfflineModeTelemetry localstorage not supported by Browser. Skip uploading")}(),this.ie)this.se.ULS.u(596444234,l.P,h.Info,"Received multiple wac complete or failure messages");else{this.ie=!0,this.sendWacPostMessage(O.yi,{}),B(this.he,t);var i=this.getApplicationState();this.ce(i),this.sendJsApiDiagnosticsToWacFrame(this.oe.diagnostics)}},t.prototype.getApplicationState=function(){return{innerApplicationFrame:this.le}},t.prototype.handleWacFailureMessage=function(t){if(this.se.ULS.u(595986315,l.P,h.Error,"Received wac failed message"),this.se.ULS.flush(),this.endUlsHeartBeat(),this.clearLogTimers(),this.ie)this.se.ULS.u(596444235,l.P,h.Info,"Received multiple wac complete or failure messages");else{this.ie=!0,this.sendWacPostMessage(O.bi,{});var i={errorType:T.WacFailed,errorObject:{}};t&&(i.errorObject=t.Error,this.fe.error=i),this.ue(i)}},t.prototype.timeoutWacAppCompleteOrFail=function(){this.ie||this.se.ULS.u(596444236,l.P,h.Warning,"Timeout. SessionTraces:"+JSON.stringify(this.fe))},t.prototype.clearLogTimers=function(){for(var t=0;t<this.ne.length;t+=1)this.ne[t]&&window.clearTimeout(this.ne[t]);this.ne=[]},t.prototype.logWarningOnNoAppComplete=function(t){this.ie||(this.se.ULS.u(594901218,l.P,h.Warning,"Boot_NotComplete_"+(t||"Final")),this.se.ULS.flush())},t.prototype.sendJsApiDiagnosticsToWacFrame=function(t){this.sendWacPostMessage(O.Ci,t)},t.prototype.beginUlsHeartBeat=function(t){var i=this;this.de=Date.now(),this.ee=window.setInterval((function(){i.se.ULS.u(595724178,l.P,h.Info,"Boot_HeartBeat"),Date.now()-i.de>i.oe.settingsManager.getSettingValue(g.gt,3e5)&&(i.logWarningOnNoAppComplete(),i.endUlsHeartBeat())}),t)},t.prototype.endUlsHeartBeat=function(){this.ee&&(window.clearInterval(this.ee),this.ee=void 0)},t.prototype.sendWacPostMessage=function(t,i){this.le&&this.le.contentWindow?this.ae.sendPostMessage(this.le.contentWindow,t,i):this.se.ULS.u(595955718,l.P,h.Info,"Attempted to send postmessage: "+t)},t}(),dt=!1,pt=!1;function vt(){dt=!1}function wt(t,i,e,n,o,r){if(i.ULS.u(595714433,l.P,h.Info,"Starting disposing the application. unloadApp:"+t+"; disposed:"+dt+"; unloading:"+pt),dt||pt&&t)i.ULS.u(595714908,l.P,h.Info,"Application is already disposed or unloading");else{var s,a={logger:i,postMessenger:e,innerApplicationFrame:n,onDisposed:o,unloadTimeoutInMs:r||1e3,forceAppUnload:!1,disposeStartTime:Date.now(),appUnloadTimedOut:!1};if(t&&n)return pt=!0,a.forceAppUnload=!0,(s=a).forceAppUnloadStartTime=Date.now(),s.logger.ULS.u(595855490,l.P,h.Info,"Sending postmessage to unload app"),s.logger.ULS.flush(),s.postMessenger.registerMessagePayloadHandler(I.li,(function(t){return function(t,i){t.forceAppUnloadEndTime=Date.now(),t.appUnloadedMessageValues=i,t.logger.ULS.u(595855491,l.P,h.Info,"AppUnloaded received from app"),mt(t)}(s,t)})),s.postMessenger.sendPostMessage(s.innerApplicationFrame.contentWindow,O.ji,{}),void window.setTimeout((function(){return function(t){!pt&&dt||(t.appUnloadTimedOut=!0,t.logger.ULS.u(595855492,l.P,h.Info,"ApplicationUnload timed out, forcing dispose"),mt(t))}(s)}),s.unloadTimeoutInMs);mt(a)}}function mt(t){if(!dt)try{dt=!0,pt=!1,function(t){if(!t.innerApplicationFrame)return;t.innerApplicationFrame.src="about:blank",window.setTimeout((function(){t.innerApplicationFrame&&t.innerApplicationFrame.parentElement&&t.innerApplicationFrame.parentElement.removeChild(t.innerApplicationFrame)}),0)}(t),function(t){var i={disposeStartTime:t.disposeStartTime,disposeEndTime:Date.now(),forceAppUnload:t.forceAppUnload,appUnloadTimedOut:t.appUnloadTimedOut};t.forceAppUnloadStartTime&&(i.appUnloadStartTime=t.forceAppUnloadStartTime);t.forceAppUnloadEndTime&&(i.appUnloadEndTime=t.forceAppUnloadEndTime);if(t.appUnloadedMessageValues){var e=t.appUnloadedMessageValues;void 0!==e.sendBeaconFlight&&(i.sendBeaconFlight=e.sendBeaconFlight),void 0!==e.sendBeaconSupported&&(i.sendBeaconSupported=e.sendBeaconSupported);var n=Number(e.hostMessageReceived);t.forceAppUnloadStartTime&&!isNaN(n)&&(i.hostToAppPostMessageLatency=n-t.forceAppUnloadStartTime);var o=Number(e.appMessageSent);!isNaN(o)&&t.forceAppUnloadEndTime&&(i.appToHostPostMessageLatency=t.forceAppUnloadEndTime-o);var r=Number(e.appUnloadStart),s=Number(e.appUnloadEnd);if(isNaN(r)||isNaN(s)||(i.appUnloadLatency=s-r),e.serverTimings){var a=e.serverTimings;for(var c in a)i["st-"+c.toString()]=a[c]}}t.logger.ULS.u(595855436,l.P,h.Info,"App disposed "+JSON.stringify(i)),t.logger.ULS.flushOnClose()}(t),t.onDisposed&&t.onDisposed()}catch(i){t.logger.ULS.u(595714434,l.P,h.Error,"Error disposing: "+c(i))}}var gt,St,_t=function(){function t(t,i,e,n,o,r,s,a,c){var u=this;this.pe=!1,this.ve=!1,this.we=!1,this.me=null,this.ge=!0,this.Se=!1,this._e=!1,this.oe=t,this.re=i,this.he=e,this.se=n,this.ae=o,this.ce=a,this.ue=c,this.fe=r,this.fe.wopiPendingInitializeTime=Date.now(),this.be=s,vt(),window.setTimeout((function(){return u.timeoutCompleteOrFail()}),5e3)}return t.prototype.Complete=function(t,i){if(this.we)this.se.ULS.u(596444184,l.P,h.Warning,"Complete called after Complete/Fail already called");else{this.se.ULS.u(596444185,l.P,h.Info,"Complete called."),this.we=!0,this.ye=t,this.fe.wopiPendingCompleteTime=Date.now();try{this.re.isSingleStepBoot?this.completeSingleStepFlow():this.completeTwoStepFlow(),this.pe&&this.sendWacPostMessage(O.Ai,{}),this.updateBrowserHistoryForCreateNew(i)}catch(t){this.se.ULS.u(596444186,l.P,h.Error,"Unexpected script error: "+c(t))}finally{this.se.ULS.flush()}}},t.prototype.Fail=function(t){this.we?this.se.ULS.u(596444187,l.P,h.Warning,"Fail called after Complete/Fail already called"):(this.se.ULS.u(596444188,l.P,h.Warning,"Fail called. Reason: "+(t?JSON.stringify(t):"N/A")),this.we=!0,this.re.isSingleStepBoot?this.failSingleStepFlow():this.failTwoStepFlow(t),this.se.ULS.flush())},t.prototype.Dispose=function(t,i,e){var n=this;wt(t||!1,this.se,this.ae,this.le,(function(){delete n.le,i&&i(),n.be(),n.ae.dispose()}),e)},t.prototype.Boot=function(){this.re.isSingleStepBoot||this.bootTwoStepFlow(),this.se.ULS.flush()},t.prototype.bootTwoStepFlow=function(){var t=this;this.se.ULS.u(596444231,l.P,h.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout((function(){return t.timeoutWacReadyMessage()}),5e3),this.populateWacFrameEventHandlersForTwoStepFlow();var i=new lt(this.oe,this.re,this.he,this.fe,this.se,this.ae,this.ce,this.ue);this.le=i.Boot()},t.prototype.populateWacFrameEventHandlersForTwoStepFlow=function(){var t=this;this.ae.registerMessagePayloadHandler(I.Gt,(function(i){t.handleWacReadyMessage(i)})),this.ae.registerMessagePayloadHandler(I.qt,(function(i){t.handleWacFrameLoadedMessage(i)})),this.ae.registerMessagePayloadHandler(I.si,(function(i){t.handleWacFrameSessionCompleteAckMessage(i)}))},t.prototype.completeTwoStepFlow=function(){var t={ParallelizeStartSession:this.ge,WacFrameIsLoaded:this.pe,WacAcceptsStartSessionComplete:this.Se};this.se.ULS.u(596444232,l.P,h.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(t)),!this.ge||this.pe&&!this.Se?this.pe&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},t.prototype.completeSingleStepFlow=function(){this.se.ULS.u(596444233,l.P,h.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),this.oe.wopiInfo=this.ye;var t=new lt(this.oe,this.re,this.he,this.fe,this.se,this.ae,this.ce,this.ue);this.le=t.Boot()},t.prototype.failTwoStepFlow=function(t){this.pe?(this.se.ULS.u(595968481,l.P,h.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(t)):(this.se.ULS.u(595968482,l.P,h.Warning,"Fail was called on the session prior to WacReady."),this.me=t)},t.prototype.sendFailurePostMessageToWacFrame=function(t){this.se.ULS.u(596444189,l.P,h.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(O.Oi,t)},t.prototype.failSingleStepFlow=function(){this.se.ULS.u(596444190,l.P,h.Warning,"Fail called during single step boot, calling host failure callback..."),this.ue({errorType:T.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},t.prototype.timeoutWacReadyMessage=function(){this.pe||(this.se.ULS.u(596444191,l.P,h.Warning,"Timeout Wac Ready"),this.ue({errorType:T.TimeoutWacReady,errorObject:void 0}))},t.prototype.timeoutCompleteOrFail=function(){this.we||(this.fe.timeoutCompleteOrFail=Date.now(),this.se.ULS.u(596444192,l.P,h.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(this.fe)))},t.prototype.timeoutWacSessionCompletionMessageAck=function(t,i,e){this._e||(this.se.ULS.u(596444193,l.P,h.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(t,i,e+1))},t.prototype.handleWacReadyMessage=function(t){if(this.fe.readyMessageReceiveTime=Date.now(),this.sendWacPostMessage(O.xi,{}),this.pe)this.se.ULS.u(596444194,l.P,h.Info,"Received multiple ready messages - frame is already loaded.");else{this.pe=!0,this.Se=t&&t.CanAcceptStartSessionComplete;var i={AcceptStartSessionComplete:this.Se,ParallelizeStartSession:this.ge,StartSessionResponse:null!=this.Ie,WopiInfo:null!=this.ye};this.se.ULS.u(596444195,l.P,h.Info,"HandleWacReadyMessage - "+JSON.stringify(i)),this.we&&(this.me?this.sendFailurePostMessageToWacFrame(this.me):this.sendWacPostMessage(O.Ai,{})),this.ge&&this.Se?this.Ie&&this.startSessionCompleted():this.ye&&this.sendWopiInfoToWacFrame(),B(this.he,t)}},t.prototype.handleWacFrameLoadedMessage=function(t){B(this.he,t)},t.prototype.handleWacFrameSessionCompleteAckMessage=function(t){this._e=!0,this.fe.sessionCompleteAckReceivedTime=Date.now()},t.prototype.sendWacPostMessage=function(t,i){this.le&&this.ae.sendPostMessage(this.le.contentWindow,t,i)},t.prototype.sendSessionCompletionMessageWithRetry=function(t,i){this.sendSessionCompletionMessageWithRetryHelper(t,i,1)},t.prototype.sendSessionCompletionMessageWithRetryHelper=function(t,i,e){var n=this;if(e>3)this.se.ULS.u(596444224,l.P,h.Error,"Attempted to call complete, but received no ack from the frame. Time: "+Date.now());else{this.se.ULS.u(596444225,l.P,h.Info,"Sending completion message to frame. Attempt number: "+e+", Time: "+Date.now());var o=Date.now();1===e&&(this.Ie&&this.Ie.Diagnostics&&(this.Ie.Diagnostics.completeMessageCreateTime=o),this.fe.completeMessageCreateTime=o),i.Diagnostics.completeMessageSendTime=o,this.fe.completeMessageSendTime=o,this.sendWacPostMessage(t,i),window.setTimeout((function(){return n.timeoutWacSessionCompletionMessageAck(t,i,e)}),1e3)}},t.prototype.makeStartSessionRequest=function(){var t=this;this.se.ULS.u(596444226,l.P,h.Info,"Making parallelized startSession request.");var i=this.buildStartSessionUrl(this.ye),e={"Content-Type":"application/x-www-form-urlencoded"},n="access_token="+encodeURIComponent(this.ye.AccessToken)+"&access_token_ttl="+encodeURIComponent(X(this.ye));this.fe.startSessionStartTime=Date.now(),function(t,i,e,n){var o=new XMLHttpRequest;for(var r in o.onreadystatechange=function(){if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{n&&n(o)}finally{null!=o&&(o.onreadystatechange=function(){})}}},o.open("POST",t),e)o.setRequestHeader(r,e[r]);o.send(i)}(i,n,e,(function(i){return t.onStartSessionRequestCompleted(i)}))},t.prototype.onStartSessionRequestCompleted=function(t){if(this.fe.startSessionCompleteTime=Date.now(),this.fe.startSessionResponseStatus=t.status,this.Ie={StartSessionResponse:{RequestStatus:t.status,ResponseText:t.responseText},Diagnostics:{wopiPendingInitializeTime:this.fe.wopiPendingInitializeTime,wopiPendingCompleteTime:this.fe.wopiPendingCompleteTime,startSessionStartTime:this.fe.startSessionStartTime,startSessionCompleteTime:this.fe.startSessionCompleteTime,readyMessageReceiveTime:this.fe.readyMessageReceiveTime}},this.se.ULS.u(596444227,l.P,h.Info,"StartSession request completed with status code: "+this.Ie.StartSessionResponse.RequestStatus+", Time: "+Date.now()),this.pe&&this.Se)this.startSessionCompleted();else{var i={WacFrameIsLoaded:this.pe,InitializeCompleted:this.ve};this.se.ULS.u(596444228,l.P,h.Info,"StartSessionCompleted not called - "+JSON.stringify(i))}},t.prototype.sendWopiInfoToWacFrame=function(){if(!this.ve){this.ve=!0,this.se.ULS.u(596444229,l.P,h.Info,"Sending wopi info to the frame.");var t={WopiDetails:{WopiSrc:this.ye.WopiSrc,AccessToken:this.ye.AccessToken,AccessTokenTtl:X(this.ye)},Diagnostics:{wopiPendingInitializeTime:this.fe.wopiPendingInitializeTime,wopiPendingCompleteTime:this.fe.wopiPendingCompleteTime,readyMessageReceiveTime:this.fe.readyMessageReceiveTime}};this.sendSessionCompletionMessageWithRetry(O.Ri,t)}},t.prototype.startSessionCompleted=function(){200===this.Ie.StartSessionResponse.RequestStatus?this.ve||(this.ve=!0,this.sendSessionCompletionMessageWithRetry(O.Hi,this.Ie)):this.sendWopiInfoToWacFrame()},t.prototype.buildStartSessionUrl=function(t){var i=this.oe.applicationBasePath+"wordeditorstartsession.ashx",e=G(this.oe,this.re,!1);return i=D(i+="?"+e.substring(e.indexOf("?")+1),"WOPISrc",encodeURIComponent(t.WopiSrc)),i=D(i,"build",encodeURIComponent(a())),i=D(i,"WacUserType",encodeURIComponent("WOPI")),this.oe.wopiPrecheckInfo.FileGetUrl&&(i=D(i,"fileGetUrlPresent","1")),i},t.prototype.updateBrowserHistoryForCreateNew=function(t){if(this.oe.isCreateNew){if(!t||!t.NewFilePath)return void this.se.ULS.u(596444230,l.P,h.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",t.NewFilePath),t.UpdatedPageTitle&&(document.title=t.UpdatedPageTitle)}},t}();!function(t){t.blurFocus="blurFocus",t.boot="boot",t.continueAccessibilityLoop="continueAccessibilityLoop",t.dispose="dispose",t.grabFocus="grabFocus",t.rename="rename",t.sendEmbeddedViewUrl="sendEmbeddedViewUrl",t.sendSessionInfo="sendSessionInfo",t.sendUserAccessAndPermissions="sendUserAccessAndPermissions",t.sendWopiInfo="sendWopiInfo",t.switchMode="switchMode"}(gt||(gt={})),function(t){t.AckExpected="ackExpected",t.ErrorObject="errorObject",t.ErrorType="errorType",t.IsDisabled="isDisabled",t.NewPageNumber="newPage",t.NewZoomLevel="newLevel",t.PageCount="pageCount"}(St||(St={}));var bt=function(){function t(t,i){var e=this;if(this.Oe=!1,this.Ee=function(t){return e.handleWacFramePostMessage(t)},this.Te=!1,this.xe=!1,this.Ce=!1,this.Ue={},!t)throw new Error("Missing origin for PostMessageHandler");this.xe=C(t),this.Ce=U(t),this.se=i,this.setOrigin(t)}return t.prototype.registerMessagePayloadHandler=function(t,i){if(this.Ue[t])throw new Error("Duplicate registration!");this.Ue[t]=i},t.prototype.removeMessageHandler=function(t){delete this.Ue[t]},t.prototype.sendPostMessage=function(t,i,e){if(t){this.se.ULS.u(596464334,l.P,h.Info,"Sending message: "+i);var n={MessageId:i,SendTime:Date.now(),Values:e};this.sendPostMessageInternal(t,JSON.stringify(n),this.Ae)}else this.se.ULS.u(595948308,l.P,h.Info,"Missing target for SendPostMessage")},t.prototype.activate=function(t,i){void 0===i&&(i=!1),this.le=t,this.Te=i,this.Oe||(window.addEventListener("message",this.Ee,!1),this.Oe=!0)},t.prototype.postMessageForCommand=function(t,i,e){var n;(n=i===gt.sendWopiInfo?O.Mi:void 0)?(this.se.ULS.u(595702598,l.P,h.Info,"Sending message "+n+" for command "+i),this.sendPostMessage(t,n,e)):this.se.ULS.u(595702599,l.P,h.Warning,"No mapping for command "+i)},t.prototype.dispose=function(){for(var t=0,i=Object.keys(this.Ue);t<i.length;t++){var e=i[t];delete this.Ue[e]}this.Oe&&(window.removeEventListener("message",this.Ee,!1),this.Oe=!1)},t.prototype.sendAckBack=function(t,i,e){if(t){var n={MessageId:O.Si,CorrelationId:e,SendTime:Date.now()};this.se.ULS.u(595732176,l.P,h.Info,"Sending Ack back"),t.postMessage(JSON.stringify(n),i)}else this.se.ULS.u(595736136,l.P,h.Info,"Missing target to send Ack back")},t.prototype.handleWacFramePostMessage=function(t){var i=!1,e=!0,n="",o=!1;if(this.le&&this.le.contentWindow&&(i=!0,e=t.source===this.le.contentWindow),t.origin&&(o=(n=R(t.origin,2).toLowerCase())===this.Re),!this.xe&&(!this.Ce||o&&e)||this.se.ULS.u(595730526,l.P,h.Info,"Window is available: "+i+", window is valid: "+e+", origin is valid: "+o+", expected origin: "+this.Re+", actual origin: "+n),o&&(!this.Te||e)){var r;try{r=JSON.parse(t.data)}catch(i){return this.se.ULS.u(596464282,l.P,h.Info,"Failed to parse event data: "+c(i)+"."),void(this.xe&&this.se.ULS.u(595732175,l.P,h.Info,"string"==typeof t.data?"Length of event data: "+t.data.length+". First 200 characters of event data: "+t.data.substring(0,200):"Event data: "+JSON.stringify(t.data)))}var s=r.MessageId;if(s){this.se.ULS.u(595714715,l.P,h.Info,"Received messageId: "+s+", correlation: "+r.CorrelationId),s!==I.Pt&&s!==I.Xt||this.setOrigin(t.origin),r.Values&&r.Values[St.AckExpected]&&this.sendAckBack(t.source,t.origin,r.CorrelationId);var a=this.Ue[s];if(a){this.se.ULS.u(596464288,l.P,h.Info,"Processing message: "+s);try{a(r.Values||{})}catch(t){this.se.ULS.u(593773704,l.P,h.Error,"Handler error: "+c(t))}}else this.se.ULS.u(596464289,l.P,h.Info,"No handler found for message id: "+s)}else(this.xe||this.Ce)&&this.se.ULS.u(595730520,l.P,h.Info,"Could not find message id")}},t.prototype.sendPostMessageInternal=function(t,i,e){t.postMessage(i,e)},t.prototype.setOrigin=function(t){var i=t.toLowerCase();this.Ae&&this.Ae!==i&&this.se.ULS.u(596128131,l.P,h.Warning,"Updating origin:"+this.Ae+"->"+i),this.Ae=i,this.Re=R(i,2),this.xe=C(i),this.Ce=U(i)},t}(),yt=function(){function t(){var t=this;if(this.Pe=[],this.Ue=[],this.We=function(){return t.handleVisibilityChange()},"hidden"===document.visibilityState){var i={visibility:document.visibilityState,time:Date.now(),initialState:!0};this.Pe.push(i)}document.addEventListener("visibilitychange",this.We)}return t.prototype.RegisterEventHandler=function(t){this.Ue.push(t)},t.prototype.RemoveEventHandler=function(t){if(t){var i=this.Ue.indexOf(t);this.Ue.splice(i,1)}},t.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.We)},t.prototype.GetVisibilityChangeEvents=function(){return this.Pe},t.prototype.Dispose=function(){this.Stop(),this.Ue=[],this.Pe=[]},t.prototype.handleVisibilityChange=function(){var t={visibility:document.visibilityState,time:Date.now(),initialState:!1};this.Pe.push(t);for(var i=0,e=this.Ue;i<e.length;i++){var n=e[i];n&&n(t)}},t}();var It=function(){function t(t,i,e){var n=this;this.Fe=0,this.Ne=[],this.ke=function(){var t=new XMLHttpRequest;t.open("GET",n.De),t.responseType="json",t.timeout=5e3,t.send(),t.onload=function(){if(200===t.status&&t.response?(n.setSettingsOnIdle(t.response),n.Fe=0):(n.se.ULS.u(592836771,l.P,h.Error,"Fetch settings error. Status: "+t.status+", curErrors: "+n.Fe),n.Fe+=1),!(n.Fe>7)){var i=n.getSettingValue(g.It,3e5);n.Fe>3&&(i+=(n.Fe-3+1)*(i/2)),n.Me=window.setTimeout(n.ke,i)}}},this.Le="Prod"+t+"Settings",this.De="AppSettingsHandler.ashx?app="+t+"&usid="+i+"&build="+a(),this.se=e,this.getCurrentSettings()}return t.prototype.initializePeriodicFetch=function(t){C(t)&&(this.Le=this.Le.replace("Prod","FF"),this.getCurrentSettings()),this.De=t+this.De,this.Me||(this.Me=window.setTimeout(this.ke,3e4))},t.prototype.getSettingValue=function(t,i){if(this.Be||this.getCurrentSettings(),!this.Be||!this.Be.hasOwnProperty(t))return i;var e=this.Be[t],n=typeof i;if(typeof e===n)return e;if("string"==typeof e){if("number"===n)return parseInt(e,10);if("boolean"===n)return"true"===e}return i},t.prototype.addSettingsChangeListener=function(t){this.Ne.push(t)},t.prototype.removeSettingsChangeListener=function(t){var i=this.Ne.indexOf(t);i>-1&&this.Ne.splice(i,1)},t.prototype.dispose=function(){this.Me&&window.clearTimeout(this.Me),this.He&&self.cancelIdleCallback(this.He),this.Me=void 0,this.He=void 0,this.Be=void 0,this.Ne=[]},t.prototype.getCurrentSettings=function(){try{if(!window||!window.localStorage)return;var t=window.localStorage.getItem(this.Le);if(!t)return;var i=JSON.parse(t);this.updateCurrentSettings(i)}catch(t){this.se.ULS.u(592836768,l.P,h.Error,"Failed to get settings from localStorage: "+c(t))}},t.prototype.updateCurrentSettings=function(t){var i=this;return!!this.isValidSettings(t)&&(this.Be=t,this.Ne.forEach((function(t){try{t(i)}catch(t){i.se.ULS.u(592836769,l.P,h.Error,"Settings listener error: "+c(t))}})),!0)},t.prototype.isValidSettings=function(t){if(t&&"object"==typeof t){if(t.hasOwnProperty(g.Ot)&&!isNaN(t.timestamp))return!0;this.se.ULS.u(592836770,l.P,h.Error,"Received invalid settings")}return!1},t.prototype.setSettingsOnIdle=function(t){var i=this;"requestIdleCallback"in window?(this.He&&self.cancelIdleCallback(this.He),this.He=window.requestIdleCallback((function(){return i.setSettings(t)}),{timeout:1e4})):window.setTimeout((function(){return i.setSettings(t)}),0)},t.prototype.setSettings=function(t){if(this.updateCurrentSettings(t)&&window&&window.localStorage){var i=JSON.stringify(t);try{window.localStorage.setItem(this.Le,i)}catch(t){this.se.ULS.u(592836800,l.P,h.Warning,"Failed to set localStorage: "+c(t))}}},t}();function Ot(t,i){return{isFeatureEnabled:function(e){return function(t,i,e){if(!i)return;try{return i(t)}catch(t){e&&e.ULS.u(594883024,l.P,h.Error,"IsFeatureEnabled callback error: "+c(t))}return}(e,t,i)}}}var Et,Tt=function(){function t(t,i){this.Je=t,this.je=i}return t.prototype.GetVersion=function(){return a()},t.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},t.prototype.Prefetch=function(t){if(null!=t&&void 0!==t){var i=document.createElement("link");i.rel="prefetch";var e=t.BootstrapperUrl;".js"!==e.toString().slice(-3)&&(e+=".js"),i.href=e;var n=document.getElementsByTagName("head")[0];null!=n&&void 0!==n&&n.appendChild(i)}},t.prototype.InitializeWopiPending=function(t,i,e,n,o,s){var f,d,p,v;try{var w=Date.now();!function(t){if(void 0===t)throw new TypeError("initParams");var i=t.Container;if(void 0===i||void 0===i.appendChild)throw new TypeError("Container");var e=t.SessionInformation;if(void 0===e||void 0===e.HostName||void 0===e.HostSessionId||void 0===e.UserId)throw new TypeError("SessionInformation");var n=t.ApplicationUrl;if(void 0===n||"string"!=typeof n)throw new TypeError("ApplicationUrl");var o=t.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===t.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===t.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(t),function(t){if(t.RebootOverrideData){var i=t.RebootOverrideData.mode.toLowerCase();if("view"!==i&&"edit"!==i)throw new Error("Unknown mode in RebootOverrideData");0,t.RebootOverrideData.queryOverrides.wdforcedmode="view"===i?"View":"Edit"}}(t);var m=void 0,g=void 0;e?m=e:t.RebootOverrideData&&!t.RebootOverrideData.isNewSession&&t.RebootOverrideData.previousSessionId?m=t.RebootOverrideData.previousSessionId:(m=(f=u())[0],g=f[1]);var S=function(t,i,e,n,o,r){void 0===r&&(r=!1),t.SessionInformation.IsCore&&(t.SessionInformation.HideViewerToolbar=!0),function(t,i){t.SessionInformation.WdParams||(t.SessionInformation.WdParams={});if(t.SessionInformation.WdParams.wd)return;i.substring(1).split("&").filter((function(i){if(0===i.indexOf("wd")){var e=i.split("=");e[0].length>2&&(t.SessionInformation.WdParams[e[0]]=e[1])}})),t.RebootOverrideData&&t.RebootOverrideData.isNewSession&&t.RebootOverrideData.previousSessionId&&(t.SessionInformation.WdParams.wdprevioussession=t.RebootOverrideData.previousSessionId)}(t,window.location.search);var s=o||new It("Excel",i,e);return{container:t.Container,sessionInformation:t.SessionInformation,applicationUrl:t.ApplicationUrl,wopiPrecheckInfo:t.WopiPrecheckInfo,applicationCustomSettings:t.ApplicationCustomSettings,diagnostics:{HostInitializeDiagnostics:t.Diagnostics},fnOnInitializeSuccess:t.FnOnInitializeSuccess,fnOnInitializeFailure:t.FnOnInitializeFailure,sessionId:i,applicationBasePath:L(t.ApplicationUrl),wopiInfo:t.WopiInfo,forceSingleStepBoot:r,isCreateNew:t.WopiPrecheckInfo.IsNewFile||"1"===k(t.ApplicationUrl,"new"),featureManager:n||Ot(t.FnIsFeatureEnabled,e),settingsManager:s,newFileTemplateSource:t.NewFileTemplateSource,rebootOverrideData:t.RebootOverrideData}}(t,m,d=i||b(m,{remoteUlsEndpoint:L(t.ApplicationUrl)+"RemoteUls.ashx"}),o,s,this.je.forceSingleStepBoot);s||(S.settingsManager.addSettingsChangeListener(d.settingsChangeHandler),S.settingsManager.initializePeriodicFetch(S.applicationBasePath)),S.diagnostics.HostInitializeDiagnostics&&(S.diagnostics.HostInitializeDiagnostics.hostInitializeCallTime=w),q(d,S,g);var _,y=function(){return V(d,"OnBeforeUnload",!0)},O=function(){return V(d,"OnPageHide",!0)},C=function(){return V(d,"VisibilityChange_"+document.visibilityState,!0)},U=function(t){return function(t,i){if(t){var e=c(i);/{("isTrusted":\w{4,5})?}/.test(e)||(t.ULS.u(594895886,l.P,h.Warning,"Unhandled Error:"+e),t.ULS.flush())}}(d,t)};window.addEventListener("beforeunload",y,{capture:!0,once:!0}),window.addEventListener("pagehide",O,{capture:!0}),window.addEventListener("visibilitychange",C,{capture:!0}),window.addEventListener("error",U,{capture:!0});var R=t&&t.BootstrapperUrl;R&&(_=this.periodicPrefetch(R,d));var P=function(){S.settingsManager.dispose(),window.removeEventListener("beforeunload",y,{capture:!0}),window.removeEventListener("pagehide",O,{capture:!0}),window.removeEventListener("visibilitychange",C,{capture:!0}),window.removeEventListener("error",U,{capture:!0}),window.clearInterval(_)},W=A(t.ApplicationUrl),F=n||new bt(W,d),N=new yt,D={},M=function(t,i){var e={isSingleStepBoot:t.forceSingleStepBoot,bootFlowType:t.forceSingleStepBoot?x.forceSingleStepBoot:x.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(t.forceSingleStepBoot,e.isSingleStepBoot){var n={singleStepBootIsRequired:!0,singleStepBootReason:e.bootFlowType,irmEnabled:t.wopiPrecheckInfo.IrmEnabled,readOnly:t.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:e.ignoreWacFramePostMessages};i.ULS.u(596444182,l.P,n.irmEnabled?h.Warning:h.Info,JSON.stringify(n))}else i.ULS.u(596444183,l.P,h.Info,"Received input valid for two step flow");return e}(S,d),B=r(r({},S.diagnostics.HostInitializeDiagnostics),{officeSessionId:S.sessionId,officeBootstrapperVersion:a(),hostName:S.sessionInformation.HostName}),H=function(t,i,e,n,o,r,s,a,u){return function(f){j(t,o,r),J(o,n,h.Info),n.ULS.u(596448985,l.P,h.Info,JSON.stringify(t));var d=u(i,n,e,s,f);try{a(d,t)}catch(t){n.ULS.u(595719171,l.P,h.Error,"Exception thrown from host's success callback: "+c(t))}z(n)}}(B,S.sessionId,F,d,D,N,P,t.FnOnInitializeSuccess,this.Je),G=function(t,i,e,n,o){return function(r){j(t,e,n),J(e,i,h.Warning),i.ULS.u(596448986,l.P,h.Error,JSON.stringify({error:r,appInitDiagnostics:t}));try{o(r,t)}catch(t){i.ULS.u(595719172,l.P,h.Error,"Exception thrown from host's failure callback: "+c(t))}z(i)}}(B,d,D,N,t.FnOnInitializeFailure);if("undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}}),t.FnOnAppModeSwitched&&F.registerMessagePayloadHandler(I.Zt,t.FnOnAppModeSwitched),t.WopiPrecheckInfo.ReadOnly&&t.FnOnAppModeSwitched,R&&this.je.preloader&&this.je.preloader.shouldPreload(S.applicationUrl))try{if(S.featureManager.isFeatureEnabled(E.Ki)){d.ULS.u(595645891,l.P,h.Info,"HTTP2 preload enabled");var X=(p=R,v=new RegExp("(c[1-5])h?(-)"),p.replace(v,"$1h$2"));this.je.preloader.preload(X,d,S.featureManager)}else this.je.preloader.preload(R,d,S.featureManager)}catch(t){d.ULS.u(595943884,l.P,h.Error,c(t))}var Z=new _t(S,M,B,d,F,D,P,H,G);return Z.Boot(),Z}catch(i){return d&&(d.ULS.u(596459925,l.P,h.Error,T.AppInitError+": "+c(i)),d.ULS.flushOnClose()),void t.FnOnInitializeFailure({errorType:T.AppInitError,errorObject:i},void 0)}},t.prototype.periodicPrefetch=function(t,i){var e=this;return window.setInterval((function(){e.Prefetch({BootstrapperUrl:t}),i.ULS.u(595895774,l.P,h.Info,"Prefetching "+M(t))}),36e5)},t}();!function(t){t.BrowserEvent="BrowserEvent",t.PageChanged="PageChanged",t.ZoomChanged="ZoomChanged",t.ContentRefreshBegin="ContentRefreshBegin",t.ContentRefreshEnd="ContentRefreshEnd",t.AppClosed="UI_Close",t.UserEdit="Edit_Notification",t.FileRename="File_Rename",t.FileShare="UI_Sharing",t.ShowFileVersions="UI_FileVersions",t.UIWorkflow="UI_Workflow",t.IsDisabled="IsDisabled",t.AccessibilityLoopComplete="App_AccessibilityLoopComplete",t.Unloaded="Unloaded",t.SwitchMode="App_SwitchMode",t.DocumentReboot="DocReboot",t.WopiInfoFromUrl="WopiInfoFromUrl",t.ModeSwitched="ModeSwitched"}(Et||(Et={}));var xt=function(){function t(t,i,e,n,o){this.Ue={},this.ze=!1,this.Ve=!1,this.qe=t,this.se=i,this.le=o.innerApplicationFrame,this.ae=e,this.Ge=n,this.registerPostMessageHandlers(),vt()}return t.prototype.GetApplicationType=function(){throw new Error("Not implemented")},t.prototype.GetVersion=function(){return a()},t.prototype.GetSessionId=function(){return this.qe},t.prototype.RegisterEventHandler=function(t,i){if(this.Ve)throw new Error("RegisterEventHandler is not supposed to be called");this.ze=!0,this.registerEventHandlerInternal(t,i)},t.prototype.RemoveEventHandler=function(t,i){if(this.Ve)throw new Error("RemoveEventHandler is not supposed to be called");switch(t){case Et.Unloaded:case Et.DocumentReboot:case Et.WopiInfoFromUrl:if(this.Ue[t]!==i)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.Ue[t];break;default:this.ae.removeMessageHandler(t)}},t.prototype.RegisterErrorHandler=function(t){},t.prototype.RemoveErrorHandler=function(t){},t.prototype.RegisterAllEventsHandler=function(t){throw new Error("RegisterAllEventsHandler is not supposed to be called")},t.prototype.PostCommand=function(t,i){this.ae.postMessageForCommand(this.le.contentWindow,t,i)},t.prototype.Dispose=function(t,i){var e=this;wt(t||!1,this.se,this.ae,this.le,(function(){delete e.le,e.Ge(),e.ae.dispose(),e.raiseEvent(Et.Unloaded,{});for(var t=0,i=Object.keys(e.Ue);t<i.length;t++){var n=i[t];delete e.Ue[n]}}),i)},t.prototype.registerEventHandlerInternal=function(t,i){switch(t){case Et.Unloaded:case Et.DocumentReboot:case Et.WopiInfoFromUrl:if(this.Ue[t])throw new Error("Duplicate registration");this.Ue[t]=i;break;default:this.ae.registerMessagePayloadHandler(t,i)}},t.prototype.registerPostMessageHandlers=function(){this.ae.registerMessagePayloadHandler(I.ti,this.handleDocumentRebootMessage.bind(this)),this.ae.registerMessagePayloadHandler(I.Vt,this.handleWopiInfoFromUrlRequest.bind(this))},t.prototype.raiseEvent=function(t,i){var e=this.Ue[t];if(e)try{e(i||{})}catch(t){this.se.ULS.u(593773706,l.P,h.Error,"Handler error: "+c(t))}},t.prototype.handleDocumentRebootMessage=function(t){t.previousSessionId=this.qe,this.raiseEvent(Et.DocumentReboot,t)},t.prototype.handleWopiInfoFromUrlRequest=function(t){this.raiseEvent(Et.WopiInfoFromUrl,t)},t}();var Ct,Ut=function(t){function i(i,e){var n=t.call(this,i,e)||this;return n.Xe=[],n.coreResourcesToObserve=[],n.initResources(),n}return o(i,t),i.prototype.initResources=function(){var t;(t=[{domain:"excel",url:"Ewa"+this.Ze+".js",localized:!1,type:"script"}]).push({domain:"excel",url:"Aacorlib"+this.$e+".js",localized:!1,type:"script"}),t.push({domain:"excel",url:"CookieCompliance.js",localized:!1,type:"script"}),t.push({domain:"excel",url:"Ewa.Strings.Wac"+this.Ze+".js",localized:!0,type:"script"}),t.push({domain:"excel",url:"EwrDefault.css",localized:!0,type:"css"}),t.push({domain:"excel",url:"excelframe.css",localized:!0,type:"css"}),t.push({domain:"excel",url:"gridRenderer"+this.$e+".js",localized:!1,type:"script"}),this.Ke&&this.Ke.isFeatureEnabled(E.Gi)&&t.push({domain:"excel",url:"adaptiveLayout"+this.$e+".js",localized:!1,type:"script"}),this.coreResourcesToObserve.push(this.Qe);for(var i=0,e=t;i<e.length;i++){var n=e[i],o=this.Ye;this.coreResourcesToObserve.push(n.url),"/"!==o[o.length-1]&&(o+="/");var r="App_Scripts";"css"===n.type&&(r="Resources");var s="";n.localized&&(s="1033/"),o+="x/s/"+this.tn+"__layouts/"+r+"/"+s+n.url,this.Xe.push(o)}},i}(function(){function t(t,i){var e;this.Ye=A(t),this.tn=function(){var t=a();if(!t)throw new Error("Build number not available");var i=t.split(".");if(4!==i.length)throw new Error("Build number has incorrect format");return i[0]+i[2]+i[3]}(),this.Ze="",this.$e=".min",this.in=(e=P())===y.Firefox||e===y.IE?"prefetch":"preload",this.Qe=M(t),this.Ke=i}return t.prototype.preloadResources=function(t){for(var i=0,e=this.Xe;i<e.length;i++){var n=e[i];this.preloadResource(n,t)}},t.prototype.preloadResource=function(t,i){var e=document.createElement("link");if(e.setAttribute("crossorigin","anonymous"),e.rel=this.in,e.href=t,i){e.addEventListener("error",(function(){i.ULS.u(595719107,l.P,h.Error,"Resource failed to load: "+M(t))}))}e.setAttribute("as","script"),document.head.appendChild(e)},t}()),At=function(){function t(){}return t.prototype.shouldPreload=function(t){return this.isExcelsUrl(t)},t.prototype.preload=function(i,e,n){var o=new Ut(i,n);t.tryObserveResourceTiming(o.coreResourcesToObserve,e),o.preloadResources(e)},t.prototype.isExcelsUrl=function(t){return t.indexOf("xlviewerinternal.aspx")>=0},t.tryObserveResourceTiming=function(t,i){window.performance&&window.performance.getEntriesByType&&window.addEventListener("load",(function(){try{for(var e=0,n=window.performance.getEntriesByType("resource");e<n.length;e++){var o=n[e],r=M(o.name);if("about:blank"!==o.name&&-1===r.indexOf("RemoteUls.ashx")&&-1===r.indexOf("mhtml:file")&&-1!==t.indexOf(r)){var s=JSON.stringify(o);s=s.replace(new RegExp(o.name,"g"),r),i.ULS.u(595736532,l.P,h.Info,s)}}window.performance.clearResourceTimings()}catch(t){i.ULS.u(595732049,l.P,h.Info,"ExcelPreloader.tryObserveResourceTiming: could not trace resource timing, error is: "+JSON.stringify(t))}}),{once:!0})},t}();!function(t){t[t.NotSupported=0]="NotSupported",t[t.SameDocOnly=1]="SameDocOnly",t[t.AnyDoc=2]="AnyDoc",t[t.OtherMode=4]="OtherMode"}(Ct||(Ct={})),e.d(i,"Application",(function(){return Rt})),e.d(i,"DocRebootSupportMode",(function(){return Ct})),e.d(i,"CommandIds",(function(){return gt}));var Rt=new Tt((function(t,i,e,n,o){return new xt(t,i,e,n,o)}),{forceSingleStepBoot:!0,preloader:new At})}});

