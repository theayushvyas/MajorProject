Type.registerNamespace("Common.App.AppsForOfficeCommon");Common.App.AppsForOfficeCommon.B=function(){};Common.App.AppsForOfficeCommon.o=function(){this.Ver=1};Common.App.AppsForOfficeCommon.e=function(n){this.b=n};Common.App.AppsForOfficeCommon.e.prototype={b:null,a:function(n,t,i){var r=new Common.App.AppsForOfficeCommon.o;r.Data=t;r.RR=i;r.CreatedOn=(new Date).getTime();this.b.a(n,Sys.Serialization.JavaScriptSerializer.serialize(r))}};Common.App.AppsForOfficeCommon.o.registerClass("Common.App.AppsForOfficeCommon.o");Type.registerNamespace("Common.App.OAuth");Common.App.OAuth.b=function(){};Common.App.OAuth.b.registerInterface("Common.App.OAuth.b");Common.App.OAuth.l=function(){};Common.App.OAuth.d=function(){};Common.App.OAuth.e=function(n,t,i){this.d=n;this.e=i.a("OAuthManagerEnableConsoleLogging");this.g=t;this.c=Common.App.OAuth.c.c();this.f=this.i(i.i.OAuthManagerHostPathOverride);this.h=i.b("OAuthManagerPromiseTimeoutInMs",0)};Common.App.OAuth.e.prototype={d:null,e:!1,g:null,c:null,f:null,h:0,b:function(){var n=this;return $$sc.h.toPromise$o(this.g.b()).then(function(){return n.j()})},a:function(n,t,i,r){t!==this.d||Common.App.OAuth.a.a||(t=null);var u=new Common.App.OAuth.e.a(n,t,this.c.authorityType,i,r,this.h);return u.j()},j:function(){var f=Common.App.OAuth.c.a(),e,t,h,r,i,c,u,n,o,s;if(Common.App.OAuth.a.a)return o=(n=new Common.fq,n.appIds=new Array(0),n.idp=f,n.authority=this.c.authority,n.redirectUri=this.f,n.upn=this.c.upn,n.enableConsoleLogging=this.e,n),this.c.authorityType===2&&(o.tenantId=this.c.tenantId),s=Common.App.OAuth.a.c.Load(o,Common.a.k),Diag.a.a(595342371,3e3,100,"WebAuthImplicitMsal package loaded."),s.Telemetry&&Diag.a.a(595342370,3e3,50,JSON.stringify(s.Telemetry)),Promise.resolve(!0);switch(this.c.authorityType){case 2:h=(t=new Common.fN,t.appId=this.d,t.authority=this.c.authority,t.redirectUri=this.f,t.upn=this.c.upn,t);e=(r=new Common.fp,r.idp=f,r.aadConfig=h,r.enableConsoleLogging=this.e,r);break;case 1:c=(i=new Common.hd,i.appId=this.d,i.authority=this.c.authority,i.redirectUri=this.f,i.upn=this.c.upn,i);e=(u=new Common.fp,u.idp=f,u.msaConfig=c,u.enableConsoleLogging=this.e,u);break;default:return Diag.a.a(41003226,3e3,100,"Non-microsoft authentication authority: {0}. WebAuthImplicit package did not load.",f),Promise.reject(!1)}return Common.App.OAuth.a.b.Load(e),Diag.a.a(41003227,3e3,100,"WebAuthImplicit package loaded."),Promise.resolve(!0)},i:function(n){var u=window.location.protocol,f=window.location.host,t=n,i,r;return isNullOrUndefined(t)&&(i=window.location.pathname,r=i.lastIndexOf("/"),t=r>=0?i.substring(0,r+1):""),u+"//"+f+t+"WacOAuth.html"}};Common.App.OAuth.e.a=function(n,t,i,r,u,f){this.a=n;this.c=t;this.h=i;this.f=r;this.b=u;this.g=f;this.i=++Common.App.OAuth.e.a.a};Common.App.OAuth.e.a.prototype={a:null,c:null,h:0,f:null,g:0,i:0,b:!1,d:0,e:0,j:function(){var t,u=Common.g.a(),f,e;Common.App.OAuth.a.a?(e=this,t=Common.App.OAuth.a.c.GetToken(this.f,this.c,Common.a.k,this.b).then(function(n){return n})):(f=this,t=Common.App.OAuth.a.b.GetToken(this.f,this.b,this.c).then(function(n){return n}));var i=this,n=this,r=this;return this.l(t).then(function(n){var t=i.k(n,!0);return t.IsSuccess?Diag.a.a(41460759,3e3,50,"Successfully retreived token for app [{0}]",i.a):Diag.a.a(41460760,3e3,15,"Failed to retrieve token for app [{0}]: {1}",i.a,JSON.stringify(t)),t},function(t){var i=n.k(t,!1);return(i.ErrorCode==="Timeout"||i.ErrorCode==="Token Renewal Failed")&&n.d<2?(n.d+=1,Diag.a.a(42267907,3e3,100,"Retrying to retrieve token for app [{0}] attempt {1}: {2}",n.a,n.d,JSON.stringify(i)),n.j()):i.ErrorCode==="login_required"&&n.h===1&&n.e<=2&&Common.a.a.a("WordOAuthTestAppPopUpIsEnabled")?(n.e+=1,Diag.a.a(41460762,3e3,100,"Retrying retrieve token for app [{0}] with popup enabled, attempt {1}: {2}",n.a,n.e,JSON.stringify(i)),n.b=!0,n.j()):(Diag.a.a(41460764,3e3,15,"Failed to retrieve token for app [{0}]: {1}",n.a,JSON.stringify(i)),i)}).then(function(n){var t={};return t.IsSuccess=n.IsSuccess,t.TokenAquired=!!n.Token&&n.Token!=="",t.ErrorCode=n.ErrorCode,t.ErrorMessage=n.ErrorMessage,t.IsAnonymous=Common.a.a.a("IsAnonymousUser"),t.IsMSAL=Common.App.OAuth.a.a,t.TimeInMS=Common.g.a()-u,t.ReplyUrlHost=window.location.host,t.AppName=r.a,t.RequestNumber=r.i,Diag.a.a(593863640,3e3,50,JSON.stringify(t)),n})},k:function(n,t){var r=Common.App.OAuth.a.a?null:n,i=Common.App.OAuth.a.a?n:null,o=null,u=null,f=null,s=null,e;return(Common.App.OAuth.a.a||r)&&(!Common.App.OAuth.a.a||i)?!Common.App.OAuth.a.a&&(r.ErrorCode||r.ErrorMessage)?(u=r.ErrorCode?r.ErrorCode:"Exception",f=r.ErrorMessage?r.ErrorMessage:"No message"):Common.App.OAuth.a.a&&(i.ErrorCode||i.ErrorMessage)?(u=i.ErrorCode?i.ErrorCode:"Exception",f=i.ErrorMessage?i.ErrorMessage:"No message"):!Common.App.OAuth.a.a&&r.Token||Common.App.OAuth.a.a&&i.Token?t?o=Common.App.OAuth.a.a?i.Token:r.Token:(u="RejectToken",f="A rejected promise returned a token."):(u="Exception",f=JSON.stringify(n)):(u="NoResult",f="No result came from WebAuthJsImplictModule.GetToken()"),i&&i.Telemetry&&(s=i.Telemetry,Diag.a.a(595150290,3e3,50,JSON.stringify(s))),(u||f)&&(o=null),e=new Common.cY,e.IsSuccess=!!o,e.Token=o,e.ErrorCode=u,e.ErrorMessage=f,e.Telemetry=s,e},l:function(n){if(this.g<=0)return n;var t=0,i=this,r=this;return Promise.race([n,new Promise(function(n){t=window.setTimeout(function(){n(i.m())},i.g)})]).then(function(n){return window.clearTimeout(t),n})},m:function(){var n=new Common.gN;return n.ErrorCode="Timeout",n.ErrorMessage="The Implicit package did not resolve the promise",n}};Common.App.OAuth.c=function(){};Common.App.OAuth.c.c=function(){var n;return n=new Common.App.OAuth.d,n.upn=Common.a.a.i.UserPrincipalName,n.authority=Common.App.OAuth.a.a?"https://login.microsoftonline.com/":Common.a.a.i.HostAuthAuthority,n.authorityType=Common.App.OAuth.c.b(),n.tenantId=Common.a.a.i.TenantId,n};Common.App.OAuth.c.b=function(){var n=0,t=Common.App.OAuth.c.a();return t.toLowerCase()==="aad"?n=2:t.toLowerCase()==="msa"&&(n=1),n};Common.App.OAuth.c.a=function(){return Common.a.a.i.HostAuthType};Common.App.OAuth.h=function(n,t){this.f=new Common.App.OAuth.j(n);this.c=t;Diag.a.a(42084323,3e3,100,"OAuthManager Created")};Common.App.OAuth.h.prototype={f:null,c:null,d:null,e:!1,g:!1,b:function(n){var t,i,r;if(Common.a.a.a("SideCarIsEnabled")){if(this.g){Diag.a.a(594057428,3e3,50,"Sidecar Auth Config already loaded");return}t=this;Common.bV.b().then(function(n){var u;if(n){var r=Common.App.OAuth.c.c(),e=Common.App.OAuth.c.a(),i,f=(i=new Common.fq,i.appIds=new Array(0),i.idp=e,i.authority=r.authority,i.redirectUri=t.h(Common.a.a.i.OAuthManagerHostPathOverride),i.upn=r.upn,i.enableConsoleLogging=Common.a.a.a("OAuthManagerEnableConsoleLogging"),i);r.authorityType===2&&(f.tenantId=r.tenantId);u=sidecar.oAuth.Load(f,null);u.Telemetry&&(Diag.a.a(594057427,3e3,50,"Loaded Sidecar Auth: "+JSON.stringify(u.Telemetry)),t.g=!0)}else Diag.a.a(594057426,3e3,50,"Failed to load Sidecar");return null})}else n&&(this.c||(this.c=new Common.App.OAuth.e(n,this.f,Common.a.a)),this.d||(i=this,r=this,this.d=this.c.b().then(function(){return i.e=!0,Diag.a.a(42084353,3e3,100,"OAuthManager initialized for app [{0}]",n),null},function(){return Diag.a.a(42267908,3e3,10,"OAuthManager failed to initialized for app [{0}], all future TryGetToken requests will fail.",n),null})))},h:function(n){var u=window.location.protocol,f=window.location.host,t=n,i,r;return isNullOrUndefined(t)&&(i=window.location.pathname,r=i.lastIndexOf("/"),t=r>=0?i.substring(0,r+1):""),u+"//"+f+t+"WacOAuth.html"},a:function(n,t){return this.j(n,t,!1)},j:function(n,t,i){var r,u,o,f,e,c;if(Diag.a.a(42084352,3e3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called",n,t),!Common.a.a.a("OAuthManagerIsEnabled"))return Promise.resolve((r=new Common.cY,r.IsSuccess=!1,r.Token=null,r.ErrorCode="NotEnabled",r.ErrorMessage="OAuthManager is disabled.",r));if(!this.i())return Promise.resolve((u=new Common.cY,u.IsSuccess=!1,u.Token=null,u.ErrorCode="NotEnabled",u.ErrorMessage="OAuthManager is disabled on Electron to avoid Popups",u));if(o=Common.App.OAuth.c.b(),f=null,o===2?f=Common.a.cw[n]:o===1&&(f=Common.App.OAuth.a.a?Common.a.cy[n]:Common.a.cx[n]),isNullOrUndefined(f))return Diag.a.a(41961345,3e3,15,"Auth context not found. Ensure that your app [{0}] is listed in WacFrameImplicitAuthAADApplications or WacFrameImplicitAuthMSAApplications.",n),Promise.resolve((e=new Common.cY,e.IsSuccess=!1,e.Token=null,e.ErrorCode="DisallowedApp",e.ErrorMessage="Disallowed appName: "+n,e));if(this.b(f),Common.a.a.a("SideCarIsEnabled"))return c=this,Common.bV.b().then(function(){return sidecar.oAuth.GetToken(n,t,0).then(function(n){var t;return t=new Common.cY,t.IsSuccess=n.IsSuccess,t.Token=n.Token,t.ErrorCode=n.ErrorCode,t.ErrorMessage=n.ErrorMessage,t})});var s=this,h=function(){if(s.e)return s.c.a(n,f,t,i);var r;return Promise.resolve((r=new Common.cY,r.IsSuccess=!1,r.Token=null,r.ErrorCode="InitFailed",r.ErrorMessage="Package failed to initialize.",r))},l=this,a=this;return this.d=this.d.then(function(){return h()},function(){return h()})},i:function(){var n=new Array(0);return Common.a.a.e("OAuthManagerDisabledBrowsers")&&(n=Common.a.a.g("OAuthManagerDisabledBrowsers"),n&&Common.c.z()&&Array.contains(n,"Electron"))?!1:!0}};Common.App.OAuth.i=function(){};Common.App.OAuth.i.a=function(){Common.App.a.a().a(new Common.App.OAuth.i,0,!1)};Common.App.OAuth.i.prototype={a:function(){return"Common.App.OAuth.OAuthPackage"},c:function(n){var t=this;n.b(Common.App.OAuth.b).a().b(function(){return new Common.App.OAuth.h(n.a(Common.fu),null)})},b:function(){Common.Utils.a.a().a(Common.App.OAuth.b).b(null)}};Common.App.OAuth.a=function(){};Common.App.OAuth.j=function(n){this.a=n};Common.App.OAuth.j.prototype={a:null,b:function(){var t=Common.App.OAuth.a.a?"webauth.implicit.msal":"webauth.implicit",n=Common.a.cf(t,2),i=Common.a.cf("es6-promise.auto",2),r;return window.self.WebAuthImplictScriptUrl=n,window.self.Es6PromisePolyfillJs=i,r=this,this.a.a(n).CW(function(){var n=window.self.Implicit;Common.App.OAuth.a.b=Common.App.OAuth.a.a?null:n;Common.App.OAuth.a.c=Common.App.OAuth.a.a?n:null;Diag.a.a(41003229,3e3,100,"WebAuth package loaded")})}};Common.App.OAuth.e.a.a=0;Common.App.OAuth.a.b=null;Common.App.OAuth.a.c=null;Common.App.OAuth.a.a=Common.a.a?Common.a.a.a("ImplicitAuthMSALIsEnabled"):!1;Common.App.OAuth.i.a();Type.registerNamespace("Common.App.OAuth");Common.App.OAuth.f=function(){};Common.App.OAuth.f.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthCommercialTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.h(function(){var r=n.d.a(Common.App.OAuth.b),t=Common.a.a.i.LokiAADAppId,i;Diag.a.a(42084354,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}","Loki",t);i=Common.g.a();r.a("Loki",t).then(function(n){var t={};t.IsSuccess=n.IsSuccess;t.TokenAquired=!!n.Token&&n.Token!=="";t.ErrorCode=n.ErrorCode;t.ErrorMessage=n.ErrorMessage;t.IsAnonymous=Common.a.a.a("IsAnonymousUser");t.IsMSAL=Common.App.OAuth.a.a;t.TimeInMS=Common.g.a()-i;t.ReplyUrlHost=window.location.host;Diag.a.a(41964885,3e3,50,JSON.stringify(t))}).catch(function(n){Diag.a.a(42084355,3e3,15,JSON.stringify(n))})})}}};Common.App.OAuth.g=function(){};Common.App.OAuth.g.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthConsumerTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.h(function(){var r=n.d.a(Common.App.OAuth.b),t=Common.a.a.i.LokiMSAAppId,i;Diag.a.a(50431968,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}","Loki",t);i=Common.g.a();r.a("Loki",t).then(function(n){var t={};t.IsSuccess=n.IsSuccess;t.TokenAquired=!!n.Token&&n.Token!=="";t.ErrorCode=n.ErrorCode;t.ErrorMessage=n.ErrorMessage;t.IsAnonymous=Common.a.a.a("IsAnonymousUser");t.IsMSAL=Common.App.OAuth.a.a;t.TimeInMS=Common.g.a()-i;t.ReplyUrlHost=window.location.host;Diag.a.a(50431969,3e3,50,JSON.stringify(t))}).catch(function(n){Diag.a.a(50431970,3e3,15,JSON.stringify(n))})})}}};Common.App.OAuth.m=function(){};Common.App.OAuth.m.a=function(){Common.a.a.a("OAuthTestAppIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.k,0,!1);Common.a.a.a("OAuthTestAppAadTokenRetrievalIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.f,0,!1);Common.a.a.a("OAuthTestAppMsaTokenRetrievalIsEnabled")&&Common.App.a.a().a(new Common.App.OAuth.g,0,!1)};Common.App.OAuth.k=function(){};Common.App.OAuth.k.prototype={d:null,a:function(){return"Common.App.OAuth.OAuthTokenRetrievalTestPackage"},c:function(n){this.d=n},b:function(){if(Common.a.a){var n=this;Common.a.a.h(function(){var u=n.d.a(Common.App.OAuth.b),t=Common.a.dm,i=t.AppName,e=t.AuthorityType,f=t.TokenTarget,r;Diag.a.a(42084356,3e3,50,"Attempting to retrieve a token for appName [{0}]: {1}",i,JSON.stringify(t));r=Common.g.a();u.a(i,f).then(function(n){var t={};t.IsSuccess=n.IsSuccess;t.TokenAquired=!!n.Token&&n.Token!=="";t.ErrorCode=n.ErrorCode;t.ErrorMessage=n.ErrorMessage;t.TimeInMS=Common.g.a()-r;Diag.a.a(41460766,3e3,50,JSON.stringify(t))}).catch(function(n){Diag.a.a(42084357,3e3,15,JSON.stringify(n))})})}}};Common.App.OAuth.m.a();Type.registerNamespace("Common.App.LivePersonaUtils");Common.App.LivePersonaUtils.b=function(){};Common.App.LivePersonaUtils.b.a=function(){Common.App.a.a().a(new Common.App.LivePersonaUtils.b,0,!1)};Common.App.LivePersonaUtils.b.prototype={a:function(){return"Common.App.LivePersonaUtils"},b:function(){Common.Utils.a.a().a(Common.dK)},c:function(n){var t=this;n.b(Common.App.LivePersonaUtils.a).c(Common.dK).a().b(function(){return new Common.App.LivePersonaUtils.a(Common.Utils.b.a(Common.App.OAuth.b,n.c(Common.App.OAuth.b)))})}};Common.App.LivePersonaUtils.a=function(n){this.b=n};Common.App.LivePersonaUtils.a.prototype={b:null,a:function(){var i=this.c(),n,t;return i?(t=this,new Promise(function(n,r){t.b.CW(function(){if(t.b.b===4||t.b.b===5){r(Error.create("Error downloading auth library"));return}t.b.a().a("Loki",i).then(function(t){var u,i,r;return u=t.IsSuccess&&t.Token?(i=new Common.ex,i.isSuccess=!0,i.token=t.Token,i.errorMessage=null,i):(r=new Common.ex,r.isSuccess=!1,r.token=null,r.errorMessage=JSON.stringify(t),r),n(u),u})})})):Promise.resolve((n=new Common.ex,n.isSuccess=!1,n.token=null,n.errorMessage=String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",Common.App.OAuth.c.a()),n))},c:function(){var n=null,t=Common.App.OAuth.c.b();return t===2?n=Common.a.a.i.LokiAADAppId:t===1&&(n=Common.a.a.i.LokiMSAAppId),n}};Common.App.LivePersonaUtils.a.registerClass("Common.App.LivePersonaUtils.a",null,Common.dK);Common.App.LivePersonaUtils.b.a();Type.registerNamespace("_Ewa");_Ewa.wh=function(n){_Ewa.wh.initializeBase(this);this.h=n;this.j()};_Ewa.wh.a=function(n){n.b().b(_Ewa.baR.$$(_Ewa.hx),350,new _Ewa.wh(n))};_Ewa.wh.prototype={h:null,b:function(){this.i(this.h.b().a(_Ewa.hx,349,!1)||new _Ewa.OAuthManagerWrapper(Common.Utils.a.a().a(Common.App.OAuth.b)))}};_Ewa.OAuthManagerWrapper=function(n){this.b=n};_Ewa.OAuthManagerWrapper.prototype={b:null,a:function(n,t){var i,r;return this.b?(r=this,this.b.a(n,t).then(function(t){t.IsSuccess||Diag.a.a(51401292,0,15,"Error retrieving auth token. Message: "+t.ErrorMessage+" Error code: "+t.ErrorCode+" App name: "+n);var i;return i=new _Ewa.wi,i.IsSuccess=t.IsSuccess,i.Token=t.Token,i.ErrorCode=t.ErrorCode,i.ErrorMessage=t.ErrorMessage,i})):(Diag.a.a(51401291,0,10,"Oauth manager is null"),Promise.resolve((i=new _Ewa.wi,i.IsSuccess=!1,i.Token=null,i.ErrorCode="FailedToResolve",i.ErrorMessage="Failed to resolve IOAuthManager from the container.",i)))}};_Ewa.wh.registerClass("_Ewa.wh",_Ewa.pZ.$$(_Ewa.hx));_Ewa.OAuthManagerWrapper.registerClass("_Ewa.OAuthManagerWrapper",null,_Ewa.hx);Type.registerNamespace("_Ewa");_Ewa.bce=function(){};_Ewa.bce.a=function(){_Ewa.j.a(function(n){_Ewa.wh.a(n)})};_Ewa.bce.a();