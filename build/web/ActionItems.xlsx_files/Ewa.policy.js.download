Type.registerNamespace("Common.App.Policy.Contracts");Common.App.Policy.Contracts.k=function(){};Common.App.Policy.Contracts.k.registerInterface("Common.App.Policy.Contracts.k");Common.App.Policy.Contracts.a=function(){};Common.App.Policy.Contracts.a.prototype={"default":0,auto:1,recommended:2,manual:3,mandatory:4};Common.App.Policy.Contracts.a.registerEnum("Common.App.Policy.Contracts.a",!1);Common.App.Policy.Contracts.b=function(){};Common.App.Policy.Contracts.b.prototype={standard:0,privileged:1};Common.App.Policy.Contracts.b.registerEnum("Common.App.Policy.Contracts.b",!1);Common.App.Policy.Contracts.c=function(){};Common.App.Policy.Contracts.c.registerInterface("Common.App.Policy.Contracts.c");Common.App.Policy.Contracts.f=function(){};Common.App.Policy.Contracts.f.prototype={none:0,reasonDefaultLabel:1,reasonManual:2,reasonAutomatic:4,reasonRecommended:8,reasonMandatory:16};Common.App.Policy.Contracts.f.registerEnum("Common.App.Policy.Contracts.f",!1);Common.App.Policy.Contracts.g=function(n,t,i){this.a=n.Id;i||(i="");this.d=t;this.c=i;this.b=n};Common.App.Policy.Contracts.g.prototype={a:null,c:null,d:!1,b:null};Common.App.Policy.Contracts.h=function(){this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.DefaultLabelId="";this.PolicyLabelAssignmentMethod="";this.PolicyLabelVersionToken="";this.SensitivityLabels=new Array(0)};Common.App.Policy.Contracts.h.prototype={AreLabelsAvailable:!1,AppliedPolicyId:null,RequiredDowngradeJustification:!1,DefaultLabelId:null,CustomUrl:null,PolicyLabelAssignmentMethod:null,PolicyLabelVersionToken:null,SensitivityLabels:null};Common.App.Policy.Contracts.q=function(){this.Id="";this.Enabled=!1;this.Name="";this.DisplayName="";this.Order=0;this.Tooltip="";this.IsEndpointProtectionEnabled=!1;this.ParentId="";this.RequiredDowngradeJustification=!1;this.LabelActions=new Array(0);this.AutoLabelingSensitiveTypeIds=new Array(0)};Common.App.Policy.Contracts.q.prototype={Id:null,Enabled:!1,Name:null,DisplayName:null,Order:0,Tooltip:null,IsEndpointProtectionEnabled:!1,ParentId:null,RequiredDowngradeJustification:!1,LabelActions:null,AutoLabelingSensitiveTypeIds:null};Common.App.Policy.Contracts.p=function(){this.Name="";this.Font="";this.FontSize=0;this.FontColor="";this.Text="";this.Margin=0;this.Alignment="";this.Placement=""};Common.App.Policy.Contracts.p.prototype={Name:null,Font:null,FontSize:0,FontColor:null,Text:null,Margin:0,Alignment:null,Placement:null};Common.App.Policy.Contracts.m=function(n,t,i,r){Common.App.Policy.Contracts.m.initializeBase(this);this.d=n;this.c=t;this.a=i;this.b=r};Common.App.Policy.Contracts.m.prototype={c:null,d:null,a:null,b:null};Common.App.Policy.Contracts.i=function(n){Common.App.Policy.Contracts.i.initializeBase(this);this.a=n};Common.App.Policy.Contracts.i.prototype={a:!1};Common.App.Policy.Contracts.d=function(){Common.App.Policy.Contracts.d.initializeBase(this)};Common.App.Policy.Contracts.o=function(n,t){Common.App.Policy.Contracts.o.initializeBase(this);this.a=n;this.b=t};Common.App.Policy.Contracts.o.prototype={a:null,b:0};Common.App.Policy.Contracts.e=function(n,t,i,r,u,f){Common.App.Policy.Contracts.e.initializeBase(this);this.f=n;this.e=t;this.d=i;this.a=r;this.b=u;this.c=f};Common.App.Policy.Contracts.e.prototype={f:0,e:null,d:null,a:null,b:null,c:!1};Common.App.Policy.Contracts.j=function(n,t){Common.App.Policy.Contracts.j.initializeBase(this);this.b=n;this.a=t};Common.App.Policy.Contracts.j.prototype={b:0,a:!1};Common.App.Policy.Contracts.l=function(n,t){this.a=n;this.b=t};Common.App.Policy.Contracts.l.prototype={a:0,b:null};Common.App.Policy.Contracts.n=function(){this.IsSuccessful=!1};Common.App.Policy.Contracts.n.prototype={IsSuccessful:!1};Common.App.Policy.Contracts.g.registerClass("Common.App.Policy.Contracts.g");Common.App.Policy.Contracts.h.registerClass("Common.App.Policy.Contracts.h");Common.App.Policy.Contracts.q.registerClass("Common.App.Policy.Contracts.q");Common.App.Policy.Contracts.m.registerClass("Common.App.Policy.Contracts.m",Sys.EventArgs);Common.App.Policy.Contracts.i.registerClass("Common.App.Policy.Contracts.i",Sys.EventArgs);Common.App.Policy.Contracts.d.registerClass("Common.App.Policy.Contracts.d",Sys.EventArgs);Common.App.Policy.Contracts.o.registerClass("Common.App.Policy.Contracts.o",Sys.EventArgs);Common.App.Policy.Contracts.e.registerClass("Common.App.Policy.Contracts.e",Sys.EventArgs);Common.App.Policy.Contracts.j.registerClass("Common.App.Policy.Contracts.j",Sys.EventArgs);Common.App.Policy.Contracts.l.registerClass("Common.App.Policy.Contracts.l");Common.App.Policy.Contracts.n.registerClass("Common.App.Policy.Contracts.n");Type.registerNamespace("Common.App.Policy");Common.App.Policy.g=function(n,t,i){this.IsPolicyTipAvailable=n;this.GeneralText=t;this.NavigateUrl=i};Common.App.Policy.d=function(){};Common.App.Policy.c=function(n,t,i,r){this.M=Function.createDelegate(this,this.X);this.D=Function.createDelegate(this,this.bg);this.E=Function.createDelegate(this,this.bh);this.C=Function.createDelegate(this,this.bf);this.F=Function.createDelegate(this,this.bj);this.z=Function.createDelegate(this,this.bd);this.G=Function.createDelegate(this,this.bl);this.B=Function.createDelegate(this,this.be);this.y=Function.createDelegate(this,this.bb);this.N=Function.createDelegate(this,this.bc);this.A=Function.createDelegate(this,this.P);this.c=n;this.e=t;this.f=i;this.b=r;this.k={};this.u={};this.q=i.a("WacApplyManualPolicyLabelIsEnabled");this.b.a().i(this.A);this.b.a().d(this.A);this.b.a().c(this.N);i.a("SupportsPolicies")&&i.c("AppliedPolicyId")&&(this.t=i.c("IrmPolicyTitle"),this.p=i.c("IrmPolicyDescription"));this.v=i.a("ProtectedFile")};Common.App.Policy.c.a=function(n){return n&&n.length?!1:!0};Common.App.Policy.c.prototype={c:null,e:null,f:null,b:null,t:null,p:null,H:!1,v:!1,m:!1,a:null,l:null,d:null,k:null,u:null,o:null,i:null,h:null,g:null,j:null,q:!1,r:null,s:null,R:function(){this.c.a(3427834559,2147483648,this.y);this.c.a(497870830,2147483648,this.B);this.c.a(941487903,2147483648,this.G);this.c.a(1145315516,2147483648,this.z);this.c.a(2935633379,2147483648,this.F);this.c.a(3134802707,2147483648,this.C);this.c.a(991261903,2147483648,this.E);this.c.a(2875864574,2147483648,this.D);this.n(941487903)||this.c.f(941487903,4);this.n(1145315516)||this.c.f(1145315516,4);this.n(2935633379)||this.c.f(2935633379,4);this.n(3134802707)||this.c.f(3134802707,4);this.n(991261903)||this.c.f(991261903,4);this.n(2875864574)||this.c.f(2875864574,4);this.e.e(!1)},bm:function(){this.c.e(3427834559,2147483648,this.y);this.c.e(497870830,2147483648,this.B);this.c.e(941487903,2147483648,this.G);this.c.e(1145315516,2147483648,this.z);this.c.e(2935633379,2147483648,this.F);this.c.e(3134802707,2147483648,this.C);this.c.e(991261903,2147483648,this.E);this.c.e(2875864574,2147483648,this.D)},bl:function(){return 32},bd:function(n,t,i,r,u){if(i===1||!this.b.a().e())return 32;var f=u,e;return f.MenuItems=(e=new Common.cH,e.Id="SensitivityList",e.MenuSectionList=[],e.UpdateDynamically=!0,e),Array.add(f.MenuItems.MenuSectionList,this.Z(!this.w())),this.a.CustomUrl&&Array.add(f.MenuItems.MenuSectionList,this.Y(this.w()?this.a.CustomUrl:Common.e.c(this.a.CustomUrl))),this.w()||(f.PopulationXML=Common.v.h(f.MenuItems)),32},bf:function(n,t,i,r,u){if(i===1||!u||!this.q)return 32;if(this.a=this.b.a().a(),this.b.a().e()){var f=u;f[Common.App.Policy.a.f]=!0;Common.bI.b("MipLabelsAvailable",!0,0,null)}return 32},bh:function(n,t,i,r,u){if(i===1||!u)return 32;var f=u,e,o;return f[Common.App.Policy.a.k]=!!(e=f[Common.App.Policy.a.p])&&!!(o=this.k[e])&&o===this.a.AppliedPolicyId,32},bg:function(n,t,i,r,u){if(i===1||!u)return 32;var f=u,e,o,s,h=!!(e=f[Common.App.Policy.a.j])&&!!(o=this.k[e])&&!!(s=this.l[o])&&s.c(this.a.AppliedPolicyId);return f[Common.App.Policy.a.l]=h,f[Common.App.Policy.a.k]=h,32},bj:function(n,t,i,r,u){if(i===1||!u)return 32;var f=u,e=f[Common.App.Policy.a.j],o=this.k[e];return this.x(o,f,2)},x:function(n,t,i){var r=i===2||i===8;return this.r&&this.r(n,r)?(Diag.a.a(42860829,306,50,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call"),this.e.e(!1),32):(t&&Common.App.Policy.a.c in t&&this.b.a().w(t[Common.App.Policy.a.c]),n?this.b.a().k()?(Diag.a.a(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",i),this.e.e(!1),r&&this.I(n,!0,$a.hh)):this.b.a().n(n)?r&&this.f.a("WacLabelingJustificationDialogIsEnabled")&&this.a.RequiredDowngradeJustification&&(n===this.a.AppliedPolicyId||this.d[n].RequiredDowngradeJustification)&&!this.o?this.bk(n):this.V(n===this.a.AppliedPolicyId?"":n,this.o,i):(Diag.a.a(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",i),this.e.e(!1),r&&this.I(n,!0,$a.ha)):(Diag.a.a(42796167,306,50,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",i),this.e.e(!1),r&&this.I("",!1,"")),32)},W:function(n,t,i,r){this.f.a("SupportsOfficeClientCoauthoring")&&this.f.a("CoAuthForProtectedFilesIsEnabled")?(this.m=!1,this.a=this.b.a().a(),this.a&&!this.a.AppliedPolicyId?this.m=!0:this.a&&this.a.PolicyLabelAssignmentMethod&&(this.m=this.a.PolicyLabelAssignmentMethod.toUpperCase()===Common.App.Policy.Contracts.b.toString(0).toUpperCase())):this.m=r;var u=Common.App.Policy.c.a(n)?null:this.d[n],f=Common.App.Policy.c.a(t)?null:this.d[t];return f?this.h=new Common.App.Policy.Contracts.g(f,!0,i):(this.b.a().b(29),this.g=null),u?this.i=new Common.App.Policy.Contracts.g(u,!1,null):this.j=null,this.P(null,null),32},T:function(){var t;if(this.d={},this.a=this.b.a().a(),this.a)for(var i=this.a.SensitivityLabels,r=i.length,n=0;n<r;++n)t=i[n],this.d[t.Id]=t},U:function(){var i,n,e;if(this.l={},this.a=this.b.a().a(),this.a){for(var u=this.a.SensitivityLabels,o=u.length,t=0;t<o;++t)i=u[t],i.ParentId||(this.l[i.Id]=new($$sc.u.$$(String)));for(var f=this.a.SensitivityLabels,s=f.length,r=0;r<s;++r)(n=f[r],n.ParentId&&n.ParentId in this.l)&&(e=this.l[n.ParentId],e.b(n.Id))}},Q:function(){this.q&&this.w()&&(this.a=this.b.a().a(),this.b.a().e())&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))},S:function(){this.f.a("WacApplyDefaultPolicyLabelIsEnabled")&&(this.H||(this.H=!0,this.a=this.b.a().a(),this.a&&this.a.DefaultLabelId)&&(Diag.a.a(593774211,306,50,"Default label configured, checking if this is a new file"),(Common.a.cO||this.s&&this.s())&&(Diag.a.a(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.a.DefaultLabelId),this.x(this.a.DefaultLabelId,null,1))))},P:function(){var n,t,i,r,u;this.b.a().k()||(n=this.d[this.b.a().a().AppliedPolicyId],this.m&&this.i&&this.j!==this.i.a&&(!n||n.Order<this.i.b.Order)&&(t=this.x(this.i.a,{},4),t!==32?Diag.a.a(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+t):(this.j=this.i.a,this.g&&(i=this.d[this.g],i&&i.Order<=this.i.b.Order&&(this.b.a().b(29),this.g=null)))),n=this.d[this.b.a().a().AppliedPolicyId],this.h&&this.g!==this.h.a&&(!n||n.Order<this.h.b.Order)&&(r=this.h.a,this.b.a().b(29),u=this,this.b.a().m(29,$a.H,String.format($a.fK,this.K(this.h.b))+" "+this.h.c,$a.fJ,function(){u.x(r,{},8)}),this.g=this.h.a),this.i=null,this.h=null)},V:function(n,t,i){this.o=t;this.b.a().x(n);this.e.e(!1);var r=this.d[n],u=new Common.App.Policy.Contracts.l(i,this.K(r));this.b.a().y(n,this.o,u)},X:function(n,t,i){n===1?this.V(t===this.a.AppliedPolicyId?"":t,i,2):this.e.e(!1)},bk:function(n){var t=new Common.App.Policy.b(n,this.M);t.bd()},I:function(n,t,i){if(t){var r=new CommonUI.d;r.M=Common.a.ca;r.h(0);r.g(1,$a.b);r.bU($a.gX,i,null)}else this.b.a().p()},w:function(){return!!this.e&&!!this.e.a()&&this.e.a().b()},L:function(){var n=this.f.a("ReactStatusBarInViewerIsEnabled")&&!this.f.a("IsSmallView");return n||this.f.a("ReactStatusBarIsEnabled")},bb:function(n,t,i){return i===1?32:(i===2,32)},be:function(n,t,i,r,u){var f,e,s;if(i===1||(this.a=this.b.a().a(),!this.a||!u))return 32;if(f=u,f[Common.App.Policy.a.a]=null,f[Common.App.Policy.a.e]=null,f[Common.App.Policy.a.b]=null,f[Common.App.Policy.a.h]=null,f[Common.App.Policy.a.i]=null,f[Common.App.Policy.a.f]=!1,this.a.AreLabelsAvailable){if(this.a.AppliedPolicyId){e=null;for(var h=this.a.SensitivityLabels,c=h.length,o=0;o<c;++o)if(s=h[o],s.Id.toLowerCase()===this.a.AppliedPolicyId.toLowerCase()){e=s;break}e&&(f[Common.App.Policy.a.a]=f[Common.App.Policy.a.e]=this.K(e),this.L()?f[Common.App.Policy.a.g]=e.Tooltip:f[Common.App.Policy.a.b]=e.Tooltip,this.v=Common.a.t=e.IsEndpointProtectionEnabled)}}else{if(!this.t)return 32;f[Common.App.Policy.a.a]=f[Common.App.Policy.a.e]=this.t;this.p&&(this.L()?f[Common.App.Policy.a.g]=this.p:f[Common.App.Policy.a.b]=this.p)}return f[Common.App.Policy.a.a]&&this.bi(this.v,f),32},K:function(n){return n?this.d?n.ParentId&&this.d[n.ParentId]?this.d[n.ParentId].DisplayName+"\\"+n.DisplayName:n.DisplayName:(Diag.a.a(4282e4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),n.DisplayName):""},bi:function(n,t){t[Common.App.Policy.a.h]=Common.a.q;t[Common.App.Policy.a.i]=n?Common.B.b(Common.App.Policy.a.r):Common.B.b(Common.App.Policy.a.t);this.L()&&(t[Common.App.Policy.a.m]=n?Common.App.Policy.a.q:Common.App.Policy.a.s);t[Common.App.Policy.a.f]=!0},Y:function(n){var i=this.J("LearnMoreSection",!0),r="SensitivityLearnMore",u=this.f.a("WacInTabOpenMRUIsEnabledForUiHost"),f=this.f.a("UiHostSupportsDocRebootFeatures"),t,e;return Diag.a.a(594383694,202,50,"[InTabOpenMRUIsEnabledForUiEmbed: {0}][UiEmbedSupportsDocReboot: {1}]",u,f),e=(t=new Common.bZ,t.Id=r,t.ExternalId=r,t.MenuItemId=n,t.LabelText=$a.bk,t.Command=u&&f?"1813655452":"1959943459",t.Image16by16=Common.a.q,t.Image16by16Class=Common.B.b(Common.App.Policy.a.n),t.Visible=!0,t.Alt=$a.L_LearnMoreTooltip,t.KeyTip="L",t),Array.add(i.ControlList,e),i},O:function(n,t,i,r,u,f,e,o){var c="Toggle_"+e+"_"+t,h=o?Common.e.c(c):c,s,l=(s=new Common.cS,s.Id=h,s.ExternalId=h,s.LabelText=o?Common.e.c(i):i,s.Command="2935633379",s.MenuItemId=h,s.QueryCommand="991261903",s.CheckedImage=Common.a.q,s.CheckedImageClass=Common.B.b(Common.App.Policy.a.d),s.ExternalImageId=Common.App.Policy.a.d,s.Visible=!0,s.Alt=o?Common.e.c(r):r,s.IsChecked=u,s.AriaLabel="menuitemradio",s.KeyTip=f,s);return h=c,this.k[h]=n,this.u[n]=h,l},J:function(n,t){var i;return i=new Common.co,i.Title="",i.Id=n,i.DisplayMode=Common.App.Policy.a.o,i.ShowMenuSectionSeparator=t,i.ControlsId="Ctrl_"+n,i.ControlList=[],i},ba:function(n,t,i){for(var u=this.J(n+"Sub",!1),f=1,e=t.$$lge(),o,r;e.$$mn();)o=e.$$cu(),r=this.d[o],r&&r.Enabled&&(Array.add(u.ControlList,this.O(r.Id,r.Name,r.DisplayName,r.Tooltip,r.Id===this.a.AppliedPolicyId,f.toString(),n,i)),f++);return u},Z:function(n){var e=this.J("SensitivitySection",!1),o=1,h=this.l,s,f,r,t,u;for(s in h){var c={key:s,value:h[s]},l=c.value,i=this.d[c.key];i&&i.Enabled&&(l.e.length?(f=n?Common.e.c(i.Name):i.Name,u=(t=new Common.cE,t.Id=f,t.ExternalId=f,t.LabelText=n?Common.e.c(i.DisplayName):i.DisplayName,t.Command="798637440",t.QueryCommand="2875864574",t.Menu=(r=new Common.cH,r.Title="",r.MenuSectionList=[],r.UpdateDynamically=!0,r),t.ExternalImageId=Common.App.Policy.a.d,t.ImageIsVisible=!1,t.Toggled=!1,t.ImageUsesSpaceWhileInvisible=!0,t.AriaLabel="menuitemradio",t.KeyTip=o.toString(),t),Array.add(u.Menu.MenuSectionList,this.ba(f,l,n)),Array.add(e.ControlList,u),this.k[u.Id]=i.Id,this.u[i.Id]=u.Id):Array.add(e.ControlList,this.O(i.Id,i.Name,i.DisplayName,i.Tooltip,i.Id===this.a.AppliedPolicyId,o.toString(),"",n)),o++)}return e},n:function(n){return!!this.c.g(n)&&!!this.c.g(n).a&&!!this.c.g(n).a.length},bc:function(n,t){var i,r;t.a&&this.d&&(i=this.d[this.b.a().a().AppliedPolicyId],i)&&(this.g&&(r=this.d[this.g],r&&r.Order<=i.Order&&(this.b.a().b(29),this.g=null)),this.j&&this.j!==i.Id&&(this.b.a().b(28),this.j=null))}};Common.App.Policy.a=function(){};Common.App.Policy.e=function(n,t,i,r,u,f,e){this.bf=Function.createDelegate(this,this.bD);this.bk=Function.createDelegate(this,this.bI);this.bl=Function.createDelegate(this,this.bJ);this.bh=Function.createDelegate(this,this.bF);this.bi=Function.createDelegate(this,this.bG);this.be=Function.createDelegate(this,this.bC);this.bg=Function.createDelegate(this,this.bE);this.bj=Function.createDelegate(this,this.bH);this.bd=Function.createDelegate(this,this.bw);this.z=new Common.V;this.J=n;this.K=t;this.B=i;this.L=r;this.A=new Common.App.Policy.Contracts.h;this.W=this.J.i.PolicyHandlerEndpointName||"PolicyHandler.ashx";this.Q=u;this.bm=e?this.bp(e):this.bp(Common.a.b().a().c());this.Y=n.a("WacApplyManualPolicyLabelIsEnabled");this.I=n.a("CoAuthForProtectedFilesIsEnabled");this.F=n.a("SupportsOfficeClientCoauthoring");f&&this.I&&this.F&&f.a(this.bd)};Common.App.Policy.e.prototype={W:null,J:null,Z:null,S:null,K:null,L:0,U:0,T:0,H:0,G:"",V:null,C:null,R:null,ba:null,A:null,Q:null,B:null,M:null,D:null,E:null,N:null,bm:null,O:null,I:!1,P:!1,g:function(n){this.z.l("PolicyTipEvent",n)},c:function(n){this.z.l("LabelInfoUpdateEvent",n)},i:function(n){this.z.l("SetPolicyLabelEventKey",n)},v:function(n){this.z.o("SetPolicyLabelEventKey",n)},d:function(n){this.z.l("SetPolicyLabelFailureEventKey",n)},u:function(n){this.z.o("SetPolicyLabelFailureEventKey",n)},l:function(n){this.z.l("GetAutoPolicyLabelEventKey",n);this.P&&(Diag.a.a(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.bs(new Common.App.Policy.Contracts.d))},s:function(n){this.z.o("GetAutoPolicyLabelEventKey",n)},f:function(n){this.z.l("AddAutoPolicyBusinessBarEntryEventKey",n)},r:function(n){this.z.o("AddAutoPolicyBusinessBarEntryEventKey",n)},h:function(n){this.z.l("RemoveAutoPolicyBusinessBarEntryEventKey",n)},t:function(n){this.z.o("RemoveAutoPolicyBusinessBarEntryEventKey",n)},Y:!1,F:!1,bx:function(){var t;if(!this.Z)return!1;for(var i=this.Z.a(),r=i.length,n=0;n<r;++n)if(t=i[n],!t.Capabilities||!t.Capabilities.SupportsClientIsMipTrusted)return!1;return!0},bn:function(){return!!this.O},q:function(n){this.R=n},bw:function(n){if(!this.bn()){var i=n.a(),t=this;i.CW(function(){t.O=i.a();t.O.j(t.bj)})}},bH:function(n,t){t.a===12&&(this.ba?this.ba():this.o(this.G,this.C,!0))},j:function(){this.B&&(this.M=this.B.a("WebServiceCall","Call Get Policy Endpoint On Server"));this.K.a(this.bb("datalosspolicy",!1),1,null,null,!0,2,this.bg,this.be,null,null,!1,null,null,null,null,!1,null,!1,null);this.U++;Diag.a.a(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.W,this.U)},o:function(n,t,i){if(this.J.a("WacLabelingGetPolicyLabelsIsEnabled")){this.G=n;this.C=t;this.B&&(this.D=this.B.a("WebServiceCall","Call Get Policy Endpoint On Server"));var r={};r["X-AppliedPolicyId"]=n;this.K.a(this.bb("getpolicylabels",i),1,null,r,!0,2,this.bi,this.bh,null,null,!1,null,null,"22",null,!1,null,!1,null);this.T++;Diag.a.a(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.T)}},a:function(){return this.A},bG:function(n){var t,i,r,u;(this.D&&(this.D.a(),this.D=null),t="",r=this.bc(n,i={val:t}),t=i.val,r)&&(Diag.a.a(34996493,306,50,"Request to get label policy data succeeded."),u=this.bL(t),this.bN(new Common.App.Policy.Contracts.d),!this.P&&u&&this.J.a("WacApplyManualPolicyLabelIsEnabled")&&this.bv()&&(this.bs(new Common.App.Policy.Contracts.d),this.P=!0))},bF:function(n){if(this.D&&(this.D.a(),this.D=null),this.T<=this.L){this.o(this.G,this.C,!1);return}Diag.a.a(34996494,306,15,"Request to get label policy failed with error response: {0}.",n?n.b?n.b.k:null:null)},bE:function(n){this.bq();var t="",i,r;(r=this.bc(n,i={val:t}),t=i.val,r)&&(Diag.a.a(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.B&&(this.N=this.B.a("Task","Parse and Handle Get Policy Response")),this.bK(t),this.N)&&(this.N.a(),this.N=null)},bC:function(n){if(this.bq(),this.U<=this.L){this.j();return}Diag.a.a(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",n?n.b?n.b.k:null:null)},k:function(){return this.H>0},x:function(n){this.A.AppliedPolicyId=n},y:function(n,t,i){if(this.Y){this.B&&(this.E=this.B.a("WebServiceCall","Call Set Policy Endpoint On Server"));var r={};r["X-SelectedPolicyLabelId"]=n;t&&(r["X-SetPolicyLabelJustification"]=encodeURIComponent(t));this.V&&(r["X-AppLockId"]=this.V);i?(r["X-SetPolicyLabelActionSource"]=this.by(i),r["X-SetPolicyLabelAssignmentMethod"]=this.bz(i)):(r["X-SetPolicyLabelActionSource"]=Common.App.Policy.Contracts.a.toString(3),r["X-SetPolicyLabelAssignmentMethod"]=Common.App.Policy.Contracts.b.toString(1));this.F&&this.I&&this.A&&(r["X-PolicyLabelVersionToken"]=this.A.PolicyLabelVersionToken);this.K.a(this.bb("setpolicylabel",!0),1,null,r,!0,2,this.bl,this.bk,i,null,!1,null,null,"32",null,!1,null,!1,null);this.H++;Diag.a.a(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.H)}},bJ:function(n){var t,u,f,e;this.E&&(this.E.a(),this.E=null);this.bo(n,f={val:t},e={val:u});t=f.val;u=e.val;var i=n.b.f,o=i?i.a:2,r="",s,h;if(!(h=this.bc(n,s={val:r}),r=s.val,h)){this.X(o);return}Diag.a.a(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",o);this.H=0;this.bM(r,t,i)},bB:function(){this.I&&this.F&&this.bn()&&this.O.v(12,null,!0)},bI:function(n){var t,i,f,e,r,u;if(this.E&&(this.E.a(),this.E=null),this.bo(n,f={val:t},e={val:i}),t=f.val,i=e.val,this.H<=this.L){this.y(t,i,null);return}r=n.b.f;u=r?r.a:2;Diag.a.a(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",n?n.b?n.b.k:null:null,u);this.H=0;this.X(u)},n:function(n){var i,r,t;if(!n)return!1;i=null;r=null;for(var f=this.A.SensitivityLabels,e=f.length,u=0;u<e;++u)t=f[u],t.Id===n&&(i=t),t.Id===this.G&&(r=t);return i?Common.a.H&&Common.a.H.a()||this.C&&this.C()?!0:this.I&&this.F&&(this.R&&this.R()||this.bx())?!0:i.IsEndpointProtectionEnabled===(!!r&&r.IsEndpointProtectionEnabled):!1},m:function(n,t,i,r,u){n===28?this.br(new Common.App.Policy.Contracts.e(n,t,i,r,u,!1)):this.br(new Common.App.Policy.Contracts.e(n,t,i,r,u,!0))},b:function(n){n===28?this.bu(new Common.App.Policy.Contracts.j(n,!1)):this.bu(new Common.App.Policy.Contracts.j(n,!0))},e:function(){var n=this;return!!this.A&&this.A.AreLabelsAvailable&&!!this.A.SensitivityLabels&&this.A.SensitivityLabels.length>0&&Common.T.a(this.A.SensitivityLabels,function(n){return!!n&&n.Enabled})},bb:function(n,t){var r=this.J.i.PolicyHandlerWebServiceBase||Common.a.b().a().n(),i=String.format("{0}{1}?action={2}&{3}",r,this.W,n,Common.a.j);return n==="setpolicylabel"&&Common.a.H&&Common.a.H.b()&&(i=Common.k.a(i,"sl","1",!1)),t&&(i=Common.k.a(i,"cbd","1",!1)),i},bo:function(n,t,i){t.val=i.val=null;n&&n.a()&&n.a().e&&n.a().e.get_headers()&&(t.val=n.a().e.get_headers()["X-SelectedPolicyLabelId"],i.val=n.a().e.get_headers()["X-SetPolicyLabelJustification"])},bc:function(n,t){return(t.val=n?n.b?n.b.a:null:null,!t.val||!t.val.length||this.bA(t.val))?(Diag.a.a(25565152,306,10,"No response data from policy endpoint."),!1):!0},bK:function(n){var t;try{t=JSON.parse(n)}catch(i){Diag.a.a(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(!t){Diag.a.a(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.");return}if(!t.IsPolicyTipAvailable){Diag.a.a(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");return}switch(t.IsPolicyTipAvailable.toLowerCase()){case"false":Diag.a.a(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");return;case"true":Diag.a.a(25565186,306,50,"DLP Policy is enabled on this document.");this.S=t.NavigateUrl;this.bQ(t.GeneralText,this.bf);break;default:Diag.a.a(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",t.IsPolicyTipAvailable)}},bM:function(n,t,i){var r=i?i.a:2,u,e,o,s,f;if(!(o=Common.bu.a(Common.App.Policy.Contracts.n,n,e={val:u}),u=e.val,o)){Diag.a.a(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",r);return}u?u.IsSuccessful?(Diag.a.a(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",r),r===2&&this.b(29),this.bP(t,r),this.bB(),this.b(28),i&&r===4&&(s=this,this.m(28,$a.H,String.format($a.fI,i.b),$a.l,function(){})),Common.bI.b("MipAppliedLabels",!0,0,[(f=new Otel.b,f.name="SetPolicyLabelApplyFlag",f.string=Common.App.Policy.Contracts.f.toString(r),f)]),this.o(t,this.C,!1)):(Diag.a.a(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",r),this.X(r),this.I&&this.F&&this.o(this.A.AppliedPolicyId,this.C,!0)):(Diag.a.a(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",r),this.X(r))},X:function(n){this.A.AppliedPolicyId=this.G;this.bt(new Common.App.Policy.Contracts.i(!1));(n===2||n===8)&&this.p()},bP:function(n,t){var i;if(this.A.AppliedPolicyId=this.G=n,n==="")Common.a.bv=!1,Common.a.t=!1;else for(var u=this.A.SensitivityLabels,f=u.length,r=0;r<f;++r)if(i=u[r],i.Id===n){Common.a.bv=i.IsEndpointProtectionEnabled;Common.a.t=i.IsEndpointProtectionEnabled;break}this.bO(new Common.App.Policy.Contracts.o(n,t))},bL:function(n){var t,i,r;return(r=Common.bu.a(Common.App.Policy.Contracts.h,n,i={val:t}),t=i.val,r)?t?t.AreLabelsAvailable?(this.A=t,this.e()&&Diag.a.a(51197846,306,50,"Labels are available for display after GetPolicyLabels call."),this.bt(new Common.App.Policy.Contracts.i(!0)),!0):!1:(Diag.a.a(42467542,306,10,"policyData is null after deserializing label policy data response."),!1):(Diag.a.a(34996495,306,10,"Error when deserializing label policy data response."),!1)},bv:function(){var n;if(!this.e())return!1;for(var i=this.A.SensitivityLabels,r=i.length,t=0;t<r;++t)if(n=i[t],n&&n.AutoLabelingSensitiveTypeIds&&n.AutoLabelingSensitiveTypeIds.length>0)return!0;return!1},bt:function(n){Diag.a.a(35393610,306,50,"Raising label info update event.");this.z.k("LabelInfoUpdateEvent",n,null)},bN:function(n){Diag.a.a(50676305,306,50,"Raising get policy label event.");this.z.k("GetPolicyLabelEventKey",n,null)},bs:function(n){if(this.Q){var t=this;this.Q.a(function(i){var r=[i.a("MsoClpSpTwo",!0),i.a("MsoDrmPremiumSpTwo",!0)];Promise.all(r).then(function(i){var r=Common.T.a(i,function(n){return n});return r&&(Diag.a.a(50944077,306,50,"Raising get auto policy label event."),t.z.k("GetAutoPolicyLabelEventKey",n,null),Common.bI.b("MipAutoClassificationEnabled",!0,0,null)),null})})}},bO:function(n){Diag.a.a(41799710,306,50,"Raising set policy label event.");this.z.k("SetPolicyLabelEventKey",n,null)},br:function(n){Diag.a.a(51128227,306,50,"Raising an add auto policy business bar entry event.");n&&n.c&&Common.bI.b("MipRecommendations",!0,0,null);this.z.k("AddAutoPolicyBusinessBarEntryEventKey",n,null)},bu:function(n){Diag.a.a(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.z.k("RemoveAutoPolicyBusinessBarEntryEventKey",n,null)},bQ:function(n,t){Diag.a.a(34996496,306,50,"Showing policy tip to user.");this.z.k("PolicyTipEvent",new Common.App.Policy.Contracts.m($a.H,n,$a.fL,t),null)},p:function(){Diag.a.a(42074656,306,50,"Raising set policy label failure event.");this.z.k("SetPolicyLabelFailureEventKey",new Sys.EventArgs,null)},w:function(n){this.V=n},bD:function(){this.S?(Diag.a.a(25565187,306,50,"DLP override button was clicked."),Common.g.e(this.S)):Diag.a.a(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")},bA:function(n){return!n.startsWith("<")||n.indexOf("Error")===-1&&n.indexOf("Unavailable")===-1?!1:(Diag.a.a(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint."),!0)},bq:function(){this.M&&(this.M.a(),this.M=null)},by:function(n){if(!n)return Common.App.Policy.Contracts.a.toString(3);var t=n.a;switch(t){case 0:return Common.App.Policy.Contracts.a.toString(3);case 4:return Common.App.Policy.Contracts.a.toString(1);case 1:return Common.App.Policy.Contracts.a.toString(0);case 16:return Common.App.Policy.Contracts.a.toString(4);case 2:return Common.App.Policy.Contracts.a.toString(3);case 8:return Common.App.Policy.Contracts.a.toString(2);default:return Common.App.Policy.Contracts.a.toString(3)}},bz:function(n){if(!n)return Common.App.Policy.Contracts.b.toString(1);var t=n.a,i=Common.App.Policy.Contracts.b.toString(1);return(t===4||t===1)&&(i=Common.App.Policy.Contracts.b.toString(0)),i},bp:function(n){switch(n){case 1:return"Excel";case 4:return"OneNote";case 2:return"PowerPoint";case 5:return"Visio";case 3:return"Word";case 0:default:return"Unknown"}}};Common.App.Policy.f=function(){this.l=Function.createDelegate(this,this.s);this.j=Function.createDelegate(this,this.q);this.n=Function.createDelegate(this,this.u);this.o=Function.createDelegate(this,this.v);this.k=Function.createDelegate(this,this.r);this.m=Function.createDelegate(this,this.t)};Common.App.Policy.f.a=function(){Common.App.a.a().a(new Common.App.Policy.f,0,!1)};Common.App.Policy.f.prototype={a:function(){return"Common.App.Policy"},d:null,g:null,f:null,e:null,h:null,i:null,b:function(){if(Common.a.a.a("ShouldInitCommonPolicyPackage")){if(Common.a.a.a("IsDataLossPreventionEnabledForUser")&&Common.a.b()){this.d=this.g.a(Common.App.Policy.Contracts.c);this.d.g(this.m);Diag.a.a(36537375,306,50,"PolicyManager is created successfully.");var n=this;Common.App.AppLifecycleManager.get_instance().a(6,function(){n.d.j()},3)}Common.a.a.a("WacLabelingPoliciesIsEnabled")&&Common.a.a.a("SupportsPolicies")&&Common.App.AppLifecycleManager.get_instance().a(6,this.k,3)}},c:function(n){var i=this,t;n.b(Common.App.Policy.Contracts.c).a().b(function(){return new Common.App.Policy.e(Common.a.a,Common.a.d,Common.a.b().d(),Common.a.a.b("MaxGetPolicyRetries",1),n.c(Common.App.ApplicationFeatureHelper.a),n.c(Common.Interface.c),Common.a.b().a().c())});t=this;n.b(Common.App.Policy.c).c(Common.App.Policy.Contracts.k).a().b(function(){return new Common.App.Policy.c(Common.a.c(),Common.a.b(),Common.a.a,n.e(Common.App.Policy.Contracts.c))});this.g=n},r:function(){this.f=this.g.a(Common.App.Policy.c);this.f.R();this.e=this.g.d(CommonUI.s);this.d||(this.d=this.g.a(Common.App.Policy.Contracts.c));this.d.c(this.o);Common.a.a.a("WacApplyManualPolicyLabelIsEnabled")&&(this.d.d(this.n),this.d.f(this.j),this.d.h(this.l))},v:function(){this.f.U();this.f.T();this.f.Q();this.f.S();Common.a.b().e(!1)},t:function(n,t){var i=this.p(t.d,t.c,null,t.b,t.a),r=Common.a.b().a();if(!r.x(i,!0)){Diag.a.a(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.");return}Diag.a.a(34174785,306,50,"Add entry to BusinessBar succeeded. Policy message is shown to user.")},u:function(){var n=this.p($a.gZ,$a.gY,null,null,null),t=Common.a.b().a();if(!t.x(n,!0)){Diag.a.a(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.");return}Diag.a.a(42074655,306,50,"Add entry to BusinessBar succeeded. CLP policy message is shown to user.")},s:function(n,t){var i;i=t.a?this.i:this.h;i&&this.e&&this.e.d(t.b)&&this.e.a(i)},q:function(n,t){if(this.e){this.d.b(t.f);var i=new CommonUI.k(t.e,t.d,null);i.e(t.f);i.d(!0);i.k(3);i.c(t.a,t.b,t.a,!0);this.e.b(i,!1,null);t.c?this.i=i:this.h=i}},p:function(n,t,i,r,u){var f=new CommonUI.k(n,t,i);return f.e(21),f.d(!0),r&&f.c(u,r,"",!1),f}};Common.App.Policy.b=function(n,t){this.b=Function.createDelegate(this,this.bb);this.R=Function.createDelegate(this,this.bl);this.e=Function.createDelegate(this,this.ba);this.a=[$a.hd,$a.hb,$a.he];Common.App.Policy.b.initializeBase(this,[!1,!1,!1,!1]);this.d=n;this.c=t;this.p=this.Z();this.h(1);this.m=Common.App.Policy.b.d;this.g(1,$a.cN);this.F(1,!1);this.I=0};Common.App.Policy.b.prototype={d:null,c:null,bd:function(){for(var n={},t=0;t<this.a.length;t++)n[Common.App.Policy.b.b+t]=!1;n[Common.App.Policy.b.a]="";this.j($a.hg,this.e,n);this.bc();Common.j.a($get(Common.App.Policy.b.a),"input",this.R)},by:function(){var t=$get(Common.App.Policy.b.a);if(t.disabled)return!0;var n=t.value,i=n.length<2,r=n.length>500,u=new RegExp("[{|}|;|\\\\]").test(n),f=Common.e.M(n)==="";return!i&&!r&&!u&&!f},ba:function(n,t){var r="",i;if(n===1)for(i=0;i<this.a.length;i++)if(t[Common.App.Policy.b.b+i]){r=i===this.a.length-1?t[Common.App.Policy.b.a]:this.a[i];break}this.c(n,this.d,r)},bl:function(n){var t=n.target;t&&this.F(1,this.by())},Z:function(){return CommonUI.b.a(Common.App.Policy.b.e,Common.a.q,Common.B.b(Common.App.Policy.b.c),$a.hc,this.a[0],this.a[1],this.a[2],$a.hf)},bc:function(){for(var t=document.getElementsByName(Common.App.Policy.b.f),n=0;n<t.length;n++)Common.j.a(t[n],"focus",this.b),Common.j.a(t[n],"click",this.b)},bb:function(n){var i=n.target,t;i&&(i.checked=!0,t=$get(Common.App.Policy.b.a),i.id===Common.App.Policy.b.b+(this.a.length-1)?(t.disabled=!1,Sys.UI.DomElement.setVisible(t,!0),t.focus()):(t.disabled=!0,i.focus()),this.F(1,this.by()))}};Common.App.Policy.c.registerClass("Common.App.Policy.c",null,Common.App.Policy.Contracts.k);Common.App.Policy.b.registerClass("Common.App.Policy.b",CommonUI.b);Common.App.Policy.d.a="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> <\/div> <\/div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}<\/label> <\/div> <\/div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'><\/input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}<\/label> <\/div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'><\/input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}<\/label> <\/div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'><\/input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}<\/label> <\/div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"><\/textarea> <\/div>";Common.App.Policy.a.r="sbProtectForm14";Common.App.Policy.a.t="SBStatusBarMarkAsReadOnly14";Common.App.Policy.a.n="Info_16x16x32";Common.App.Policy.a.d="CommonControlCheckboxCheck_16";Common.App.Policy.a.k="On";Common.App.Policy.a.f="Visible";Common.App.Policy.a.l="ImageIsVisible";Common.App.Policy.a.j="SourceControlId";Common.App.Policy.a.p="MenuItemId";Common.App.Policy.a.o="Menu";Common.App.Policy.a.c="AppLockId";Common.App.Policy.a.a="Value";Common.App.Policy.a.e="LabelText";Common.App.Policy.a.b="Alt";Common.App.Policy.a.h="Image16by16";Common.App.Policy.a.i="Image16by16Class";Common.App.Policy.a.q="SBProtectForm_16";Common.App.Policy.a.s="SBStatusBarMarkAsReadOnly_16";Common.App.Policy.a.m="Icon";Common.App.Policy.a.g="CustomTooltip";Common.App.Policy.b.e=Common.App.Policy.d.a;Common.App.Policy.b.f="ListRadioBox";Common.App.Policy.b.b="radiobox";Common.App.Policy.b.a="txtJustification";Common.App.Policy.b.c="Info_32x32x32";Common.App.Policy.b.d="JustificationDialog";Common.App.Policy.f.a();Type.registerNamespace("_Ewa");_Ewa.MP=function(n,t,i,r,u,f){this.f=Function.createDelegate(this,this.n);this.g=Function.createDelegate(this,this.p);this.h=Function.createDelegate(this,this.q);this.c=n;this.e=t;this.b=i;this.a=r;this.d=u;this.i=f;this.o()};_Ewa.MP.prototype={c:null,d:null,b:null,a:null,e:null,i:null,l:3,dispose:function(){this.s();this.c=null;this.e=null;this.b=null},o:function(){this.b.f(this.h);this.b.h(this.g);this.c.a(_Ewa.nE.a());this.c.b(_Ewa.nE.a(),this.f)},s:function(){this.a.b(32);this.a.b(31);this.b.r(this.h);this.b.t(this.g);this.c.c(_Ewa.nE.a(),this.f)},n:function(n,t){var i;if(Diag.a.a(50935426,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation Called Successfully."),t.b===3){Diag.a.a(51512411,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete Annotation operation");return}if(i=t.a,!i){Diag.a.a(50974996,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}var r=null,u=null,f=null;i.automatic&&i.automatic.sensitivityLabel&&i.automatic.sensitivityLabel.id&&(r=i.automatic.sensitivityLabel.id);i.recommended&&i.recommended.sensitivityLabel&&i.recommended.sensitivityLabel.id&&(u=i.recommended.sensitivityLabel.id,i.recommended.sensitivityLabel.policyTip&&(f=i.recommended.sensitivityLabel.policyTip));this.d.a(875)&&this.i.a("SupportsOfficeClientCoauthoring")?(Diag.a.a(593102819,306,50,"AutoPolicyManager::LabellingAnnotationHandler Auto classification for Clients supporting client coauthoring."),this.j(r,u,f,!1)):this.k(r,u,f,1)},k:function(n,t,i,r){var u=this.d.d().a().b(!1),f=this,e=this;_Ewa.pL.b(this.d.d().a(),this.d.f().DocumentHostInfo.TenantId,function(r){f.r(r,n,t,i)},function(){e.m(n,t,i,r)},null,u)},r:function(n,t,i,r){var u,f;Diag.a.a(51680789,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");u=!1;n&&!_Ewa.S.a(n)?(f=n.Result,f===4&&(u=!0)):Diag.a.a(51680790,306,50,"AutoPolicyManager: Result of GetPolicyApplicationMethod is NULL.");this.j(t,i,r,u)},m:function(n,t,i,r){r<=this.l&&(Diag.a.a(51680791,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again"),this.k(n,t,i,r+1));Diag.a.a(51680792,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Max retries exhausted.");this.j(n,t,i,!1)},j:function(n,t,i,r){if(Diag.a.a(51680793,306,50,"AutoPolicyManager: Calling ApplyAutoPolicyLabel with isManual set to {0}.",!r),this.e)var u=this.e.W(n,t,i,r)},p:function(n,t){if(!t){Diag.a.a(51241993,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.");return}t.a&&this.a.c(32)?(this.a.b(32),Diag.a.a(51241994,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):!t.a&&this.a.c(31)&&(this.a.b(31),Diag.a.a(51241995,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded."))},q:function(n,t){var i,r;if(!t){Diag.a.a(51241996,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.");return}t.c?(i=this,this.a.j(t.e,t.d,t.a,function(n){t.b(n);i.a.c(32)&&i.a.b(32)}),Diag.a.a(51241997,306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(r=this,this.a.g(t.e,t.d,t.a,function(n){t.b(n);r.a.c(31)&&r.a.b(31)}),Diag.a.a(51241998,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user."))}};_Ewa.wz=function(n,t){_Ewa.wz.initializeBase(this,[n,_Ewa.wz.a(n,t)])};_Ewa.wz.a=function(n,t){return n.r()&2?_Ewa.h.b(3,1,0,t?1662:1664,0,t?-1237306487:-571684981,t?"SensitivityLabelBlockApplyLabelOpenInDesktop":"SensitivityLabelBlockRevertLabelOpenInDesktop"):_Ewa.h.b(1,1,0,t?1663:1665,0,t?-313914360:392034310,t?"SensitivityLabelBlockApplyLabel":"SensitivityLabelBlockRevertLabel")};_Ewa.wz.prototype={H:function(){var t,n;_Ewa.dq.prototype.H.call(this);this.y.Appearance&1&&this.A.r()&2&&(t=this.n(0),_Ewa.a.X(t.get_element(),_Ewa.ClientStringManager.a().a(1124)),n=this,this.f(function(){0===n.N&&n.A.r()&2&&(Diag.a.a(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),_Ewa.f.cw(_Ewa.l.b(_Ewa.gi,n.A.b(),55,56,-2),function(n){n.a().a()},n.A.i(),3))}))}};_Ewa.wA=function(n){_Ewa.wA.initializeBase(this);this.h=n;this.j()};_Ewa.wA.a=function(n){n.b().b(_Ewa.baR.$$(_Ewa.iA),275,new _Ewa.wA(n))};_Ewa.wA.prototype={h:null,b:function(){var t=_Ewa.l.b(_Ewa.cM,this.h.b(),5,4,this.l),i=Common.a.d,r=Common.a.a,n=this;_Ewa.f.cw(t,function(){try{var u=new($$sc.y.$$(Common.App.Policy.Contracts.c))(function(){return new Common.App.Policy.e(r,i,Common.a.b().d(),n.h.f().MaxGetPolicyRetries,Common.Utils.a.a().c(Common.App.ApplicationFeatureHelper.a),null,0)}),e=new($$sc.y.$$(Common.App.Policy.c))(function(){return new Common.App.Policy.c(Common.a.c(),Common.a.b(),Common.a.a,u)});n.i(n.h.b().a(_Ewa.iA,274,!1)||new _Ewa.PolicyManagerWrapper(u.a(),e.a(),t.a(),n.h,Common.a.a))}catch(f){Diag.a.a(36444224,306,10,"PolicyManager was not created successfully [Exception: {0}]",f.toString());throw f;}},this.dD(),3)}};_Ewa.PolicyManagerWrapper=function(n,t,i,r,u){if(this.G=Function.createDelegate(this,this.X),this.I=Function.createDelegate(this,this.bf),this.u=Function.createDelegate(this,this.J),this.t=Function.createDelegate(this,this.O),this.w=Function.createDelegate(this,this.Y),this.v=Function.createDelegate(this,this.U),this.x=Function.createDelegate(this,this.Z),this.y=Function.createDelegate(this,this.bc),this.F=Function.createDelegate(this,this.W),this.E=Function.createDelegate(this,this.V),this.D=Function.createDelegate(this,this.N),this.H=Function.createDelegate(this,this.bb),_Ewa.PolicyManagerWrapper.initializeBase(this,[!1]),Diag.a.a(34402886,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.f=r,this.g=n,this.p=i,this.m=u,this.g.g(this.H),this.S(),this.l=t,this.f.a(456)&&this.m.a("SupportsPolicies")){this.h=this.m.c("AppliedPolicyId");this.l.R();var f=this;this.f.b().c(_Ewa.bM,29,function(n){f.r=n;n.c(f)});this.L();this.ba();this.l.r=this.D;this.f.a(886)&&(this.l.s=this.E);this.f.a(875)&&this.g.q(this.F)}};_Ewa.PolicyManagerWrapper.prototype={g:null,f:null,m:null,r:null,l:null,s:!1,p:null,o:!1,n:null,k:function(n){this.dE("LabelInfoChangedKey",n)},j:function(n){this.dF("LabelInfoChangedKey",n)},i:function(){return!0},d:function(n,t){if(n!=="QueryPolicyLabel")return!1;var i=Common.a.c().c(497870830,2,t,null);return i===32},dispose:function(){if(this.r&&(this.r.b(this),this.r=null),this.l.bm(),this.s=!1,this.f.a(457))if(this.g.u(this.y),this.g.v(this.x),this.f.a(875)&&this.m.a("SupportsOfficeClientCoauthoring")){var n=this.f.b().a(_Ewa.lm,292,!1);n&&n.d(this.w)}else this.f.c().w(this.v);this.f.a(457)&&this.f.a(460)&&this.f.a(386)&&(this.n&&this.n.dispose(),this.g.s(this.t),this.f.c().R(this.u));_Ewa.co.prototype.dispose.call(this)},C:null,e:function(){return this.C},B:null,c:function(){return this.B},z:null,a:function(){return this.z},A:null,b:function(){return this.A},h:null,L:function(){this.dC("LabelInfoChangedKey",null,null)},S:function(){this.g.j()},T:function(){return this.f.f().DocumentHostInfo.TenantId},ba:function(){Common.a.s("Microsoft.Office.Excel.Server.Flighting.IDenyListApplyManualPolicyLabel");var n=this;Common.App.AppLifecycleManager.get_instance().a(10,function(){if(n.g.c(n.I),n.f.a(457)){if(n.g.d(n.y),n.g.i(n.x),n.f.a(875)&&n.m.a("SupportsOfficeClientCoauthoring")){var t=n.f.b().a(_Ewa.lm,292,!1);t&&t.b(n.w)}else n.f.c().v(n.v);n.f.a(460)&&n.f.a(386)&&n.g.l(n.t)}n.Q()},3)},Q:function(){this.f.a(875)&&this.m.a("SupportsOfficeClientCoauthoring")||this.h&&this.h.length?this.q(!0,!1):this.R(this.T())},O:function(n,t){this.f.c().H(this.u);this.J(n,t)},J:function(){var n,t;if(!this.f.isChangeGateEnabled("OfficeVSO:4082507_DisableAutoLabellinginViewMode")||this.f.k()){if(this.o)return;n=this.f.f().FlightingSettings.AutoCLPStartUpDelay;Diag.a.a(51709772,306,50,"License check succeeded for Auto Labelling. Configured delay is {0} milliseconds",n);t=this;_Ewa.x.a().a(function(){t.bd(n)},n,_Ewa.m.bI,!0,!0);this.o=!0}else if(this.o){if(this.o=!1,!this.n){Diag.a.a(593098975,306,15,"Autopolicy manager should not be null here");return}this.n.dispose()}},bd:function(n){Diag.a.a(51515659,306,50,"Auto Labelling is enabled. Configured delay is {0} milliseconds",n);var t=this;_Ewa.f.cw(_Ewa.l.b(_Ewa.lU,this.f.b(),328,327,-2),function(n){var i=n.a();if(!i){Diag.a.a(51515660,306,10," Error occurred while creating an augmentationLoopManager instance");return}Diag.a.a(51515661,306,50,"AugmentationLoopManager instantiated successfully.");t.n=new _Ewa.MP(i,t.l,t.g,t.p,t.f,t.m)},this.dD(),3)},R:function(n){Diag.a.a(41740191,306,50,"PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length {0}",n.length);var t=this.f.d().a().b(!1),i=this;_Ewa.pL.c(this.f.d().a(),n,function(n){i.be(n)},null,null,t)},be:function(n){Diag.a.a(41740192,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");n&&!_Ewa.S.a(n)&&(this.h=n.Result);this.q(!0,!1);this.h?Diag.a.a(41740193,306,50,"PolicyManagerWrapper: Fetched LabelId length from custom.xml is {0}",this.h.length):Diag.a.a(41740194,306,50,"PolicyManagerWrapper: LabelId is invalid")},q:function(n,t){n&&Diag.a.a(51238051,306,50,"PolicyManagerWrapper.GetDocumentPolicyLabels: Workbook info hasLabel = {0}, isProtectedFile = {1}",!!this.h&&this.h.length>0,this.m.a("ProtectedFile"));this.g.o(this.h,null,t)},bb:function(n,t){if(!t){Diag.a.a(34402887,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.");return}this.C=t.d;this.B=t.c;this.z=t.a;this.A=t.b;this.p.a(25,null);Diag.a.a(34402888,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")},bc:function(){this.p.a(37,null)},bf:function(){this.l&&(Diag.a.a(41961095,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.l.U(),this.l.T(),this.f.a(457)&&this.l.Q(),this.f.a(886)&&this.l.S());this.f.a(875)&&this.m.a("SupportsOfficeClientCoauthoring")&&(this.h=this.g.a().AppliedPolicyId);this.P();this.L()},Z:function(n,t){Diag.a.a(42322116,306,50,"PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label.");var r=this.g.a(),u=JSON.stringify(r),f=this.f.d().a(),i=this,e=function(n){return _Ewa.pL.a(f,u,t.a,i.f.f().DocumentHostInfo.TenantId,t.b,_Ewa.o.a.call(null,n,i.G),null,t.a,null)},o=this;_Ewa.P.a(this.f.g(),e,function(n){return new _Ewa.H(222,0,n,0,null)},null)},P:function(){this.s||(this.f.B(),this.s=!0)},X:function(n,t){Diag.a.a(42763015,306,100,"PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback: Invoking GetPolicyLabels to update UI.");this.h=t;this.q(!1,!0)},N:function(n,t){var f=this.g.a(),r,u,i;if(!f)return Diag.a.a(50341184,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;r=null;u=null;for(var o=f.SensitivityLabels,s=o.length,e=0;e<s;++e)i=o[e],_Ewa.e.b(i.Id,n,!1)&&(u=i),_Ewa.e.b(i.Id,f.AppliedPolicyId,!1)&&(r=i);return r&&this.K(r)?(Diag.a.a(50341185,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: currentAppliedSensitivityLabel has watermark label action."),this.M(!1,t),!0):u&&this.K(u)?(Diag.a.a(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.M(!0,t),!0):!1},V:function(){var n=!1;return!this.f.f().IsNewWorkbook||this.h&&this.h.length||(n=!0),Diag.a.a(593065680,306,50,"PolicyManagerWrapper.IsANewFile: is this a new file : {0}",n),n},K:function(n){for(var r,i=n.LabelActions,u=i.length,t=0;t<u;++t)if(r=i[t],_Ewa.e.b(r.Name,"ApplyWatermark",!1))return!0;return!1},M:function(n,t){if(!t){Diag.a.a(51654868,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.");return}var i=new _Ewa.wz(this.f,n);i.w(!1)},U:function(){var n=this.f.c().t();n&&n.AppliedPolicyLabelId&&!_Ewa.e.b(n.AppliedPolicyLabelId,this.h,!1)&&(Diag.a.a(42844434,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),this.h=n.AppliedPolicyLabelId,this.q(!1,!0))},W:function(){for(var r,n=!0,i=this.f.c().s(),u=i.length,t=0;t<u;++t)if(r=i[t],!r.SupportsClientIsMipTrusted){n=!1;break}return Diag.a.a(593007453,306,50,"PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : {0}",n),n},Y:function(){Diag.a.a(592723985,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.q(!1,!0)}};_Ewa.pL=function(){};_Ewa.pL.c=function(n,t,i,r,u,f){var e=n.a(1,f);return e.tenantId=t,_Ewa.i.a(n,"GetPolicyLabelId",e,i,r,u,4,null)};_Ewa.pL.a=function(n,t,i,r,u,f,e,o,s){var h=n.a(41,s);return h.labelsInfoJson=t,h.appliedLabelId=i,h.tenantId=r,h.applyLabelFlag=u,_Ewa.i.a(n,"ApplyPolicyLabel",h,f,e,o,0,null)};_Ewa.pL.b=function(n,t,i,r,u,f){var e=n.a(1,f);return e.tenantId=t,_Ewa.i.a(n,"GetPolicyApplicationMethod",e,i,r,u,4,null)};_Ewa.MQ=function(n){this.a=n};_Ewa.MQ.prototype={a:null,z:function(){return!1},w:function(n,t,i){var r;switch(t.a){case 2935633379:return this.a.l().FileCoauthorable||(i[Common.App.Policy.a.c]=this.a.l().ExclusiveLockId),r=Common.a.c().c(2935633379,2,i,null),$$sc.a.a(Boolean,r===32);case 2875864574:return r=Common.a.c().c(2875864574,2,i,null),$$sc.a.a(Boolean,r===32);case 991261903:return r=Common.a.c().c(991261903,2,i,null),$$sc.a.a(Boolean,r===32);default:return _Ewa.J.a(t.a)}},v:function(n,t){switch(t.a){case 2935633379:case 2875864574:case 991261903:return this.a.a(456)&&this.a.a(457);default:return!1}},x:function(n,t,i){switch(t){case"PopulateSensitivityFlyout":if(!this.a.a(456)||!this.a.a(457))return!1;var r=Common.a.c().c(1145315516,2,i,null);return r===32;default:return!1}}};_Ewa.wB=function(n){_Ewa.wB.initializeBase(this,[n])};_Ewa.wB.a=function(n){_Ewa.Z.a(316,new _Ewa.wB(n))};_Ewa.wB.prototype={m:function(){this.k([new _Ewa.MQ(this.h)],null)}};_Ewa.RN=function(){};_Ewa.RN.prototype={match:null,offset:0,length:0};_Ewa.RQ=function(){};_Ewa.RQ.prototype={idMatch:null,offset:0,length:0,evidences:null};_Ewa.RV=function(){_Ewa.RV.initializeBase(this);var n;this.H_=(n=new _Ewa.kh,n.T_=_Ewa.RV.getTypeName(),n.B_=_Ewa.RV.getBaseTypes(),n)};_Ewa.RV.prototype={sensitiveItemId:null,displayName:null,detectionLevel:null,uniqueCount:0,confidence:0,matches:null};_Ewa.RO=function(){};_Ewa.RO.prototype={name:null,placement:null,fontSize:null,text:null,fontColor:null,margin:null,alignment:null,encryptWith:null,templateId:null,availableForEncryption:null};_Ewa.RW=function(){};_Ewa.RW.prototype={id:null,name:null,description:null,toolTip:null,policyTip:null,isEndpointProtectionEnabled:null,labelActions:null,displayName:null,priority:null,applicationMode:null};_Ewa.RT=function(){};_Ewa.RT.prototype={id:null,name:null,description:null,rulePackageId:null,rulePackageType:null,publisherName:null};_Ewa.RS=function(){};_Ewa.RS.prototype={id:null,name:null};_Ewa.RP=function(){};_Ewa.RP.prototype={sensitivityLabel:null,responsibleSensitiveTypes:null,responsiblePolicy:null};_Ewa.RU=function(){};_Ewa.RU.prototype={id:null,name:null,description:null,matches:null};_Ewa.RR=function(){};_Ewa.RR.prototype={sensitivityLabel:null,responsiblePolicy:null,sensitiveItems:null};_Ewa.nE=function(){_Ewa.nE.initializeBase(this);var n;this.H_=(n=new _Ewa.kh,n.T_=_Ewa.nE.a(),n.B_=_Ewa.nE.getBaseTypes(),n)};_Ewa.nE.a=function(){return"AugLoop_Automatic_Clp_LabellingAnnotation"};_Ewa.nE.prototype={recommended:null,automatic:null};_Ewa.MP.registerClass("_Ewa.MP",null,Sys.IDisposable);_Ewa.wz.registerClass("_Ewa.wz",_Ewa.dq);_Ewa.wA.registerClass("_Ewa.wA",_Ewa.pZ.$$(_Ewa.iA));_Ewa.PolicyManagerWrapper.registerClass("_Ewa.PolicyManagerWrapper",_Ewa.co,_Ewa.uX,Common.IRootUser,_Ewa.iA);_Ewa.MQ.registerClass("_Ewa.MQ",null,_Ewa.jK);_Ewa.wB.registerClass("_Ewa.wB",_Ewa.Z);_Ewa.RV.registerClass("_Ewa.RV",_Ewa.RH);_Ewa.RW.registerClass("_Ewa.RW");_Ewa.RP.registerClass("_Ewa.RP");_Ewa.RR.registerClass("_Ewa.RR");_Ewa.nE.registerClass("_Ewa.nE",_Ewa.RH);Type.registerNamespace("_Ewa");_Ewa.bcz=function(){};_Ewa.bcz.a=function(){_Ewa.j.a(function(n){_Ewa.wA.a(n);n.a(456)&&_Ewa.wB.a(n)})};_Ewa.bcz.a();